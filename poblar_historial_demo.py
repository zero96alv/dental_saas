#!/usr/bin/env python
"""
Script para poblar datos de demostración del historial clínico mejorado
Este script crea categorías y preguntas de ejemplo para demostrar las nuevas funcionalidades
"""

import os
import sys
import django

# Configurar Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'dental_saas.settings')
sys.path.append(os.path.dirname(os.path.abspath(__file__)))
django.setup()

from core import models

def crear_categorias_historial():
    """Crear categorías para el historial clínico"""
    print("Creando categorías de historial clínico...")\n    \n    categorias = [\n        {\n            'nombre': 'Datos Generales',\n            'descripcion': 'Información básica del paciente',\n            'icono': 'fas fa-user',\n            'color': '#3b82f6',\n            'orden': 1\n        },\n        {\n            'nombre': 'Signos Vitales',\n            'descripcion': 'Medición de signos vitales básicos',\n            'icono': 'fas fa-heartbeat',\n            'color': '#ef4444',\n            'orden': 2\n        },\n        {\n            'nombre': 'Antecedentes Patológicos Personales',\n            'descripcion': 'Historial médico personal del paciente',\n            'icono': 'fas fa-file-medical-alt',\n            'color': '#f59e0b',\n            'orden': 3\n        },\n        {\n            'nombre': 'Antecedentes Familiares',\n            'descripcion': 'Historial médico familiar',\n            'icono': 'fas fa-users',\n            'color': '#10b981',\n            'orden': 4\n        },\n        {\n            'nombre': 'Dolor y Molestias',\n            'descripcion': 'Evaluación del dolor y molestias actuales',\n            'icono': 'fas fa-thermometer-half',\n            'color': '#8b5cf6',\n            'orden': 5\n        },\n        {\n            'nombre': 'Hábitos Orales',\n            'descripcion': 'Hábitos relacionados con la salud oral',\n            'icono': 'fas fa-teeth',\n            'color': '#06b6d4',\n            'orden': 6\n        },\n        {\n            'nombre': 'Exploración Física',\n            'descripcion': 'Examen físico general',\n            'icono': 'fas fa-stethoscope',\n            'color': '#84cc16',\n            'orden': 7\n        },\n        {\n            'nombre': 'Alergias y Medicamentos',\n            'descripcion': 'Alergias conocidas y medicamentos actuales',\n            'icono': 'fas fa-pills',\n            'color': '#f97316',\n            'orden': 8\n        }\n    ]\n    \n    for cat_data in categorias:\n        categoria, created = models.CategoriaHistorial.objects.get_or_create(\n            nombre=cat_data['nombre'],\n            defaults=cat_data\n        )\n        if created:\n            print(f\"  ✓ Creada categoría: {categoria.nombre}\")\n        else:\n            print(f\"  - Ya existe: {categoria.nombre}\")\n\ndef crear_preguntas_historial():\n    """Crear preguntas de ejemplo para cada categoría\"\"\"\n    print(\"\\nCreando preguntas de historial clínico...\")\n    \n    # Obtener categorías\n    try:\n        datos_generales = models.CategoriaHistorial.objects.get(nombre='Datos Generales')\n        antecedentes_personales = models.CategoriaHistorial.objects.get(nombre='Antecedentes Patológicos Personales')\n        dolor = models.CategoriaHistorial.objects.get(nombre='Dolor y Molestias')\n        alergias = models.CategoriaHistorial.objects.get(nombre='Alergias y Medicamentos')\n        habitos = models.CategoriaHistorial.objects.get(nombre='Hábitos Orales')\n    except models.CategoriaHistorial.DoesNotExist as e:\n        print(f\"Error: No se encontró una categoría requerida: {e}\")\n        return\n    \n    preguntas = [\n        # Datos Generales\n        {\n            'categoria': datos_generales,\n            'texto': '¿Cuál es el motivo principal de su consulta dental?',\n            'subtitulo': 'Describa brevemente qué le trae al dentista hoy',\n            'tipo': 'TEXTAREA',\n            'orden': 1,\n            'obligatoria': True,\n            'importancia': 'ALTA'\n        },\n        {\n            'categoria': datos_generales,\n            'texto': '¿Ha visitado al dentista en los últimos 6 meses?',\n            'tipo': 'SI_NO',\n            'orden': 2,\n            'obligatoria': True,\n            'importancia': 'MEDIA'\n        },\n        \n        # Antecedentes Patológicos Personales\n        {\n            'categoria': antecedentes_personales,\n            'texto': '¿Padece diabetes?',\n            'subtitulo': 'Incluya diabetes tipo 1, tipo 2 o gestacional',\n            'tipo': 'SI_NO',\n            'orden': 1,\n            'obligatoria': True,\n            'importancia': 'ALTA',\n            'requiere_seguimiento': True\n        },\n        {\n            'categoria': antecedentes_personales,\n            'texto': '¿Tiene problemas cardiacos?',\n            'subtitulo': 'Arritmias, infartos previos, marcapasos, etc.',\n            'tipo': 'SI_NO',\n            'orden': 2,\n            'obligatoria': True,\n            'importancia': 'CRITICA',\n            'requiere_seguimiento': True\n        },\n        {\n            'categoria': antecedentes_personales,\n            'texto': '¿Sufre de hipertensión arterial?',\n            'tipo': 'SI_NO',\n            'orden': 3,\n            'obligatoria': True,\n            'importancia': 'ALTA',\n            'requiere_seguimiento': True\n        },\n        {\n            'categoria': antecedentes_personales,\n            'texto': '¿Ha sido hospitalizado en el último año?',\n            'subtitulo': 'Incluya cirugías, emergencias o tratamientos prolongados',\n            'tipo': 'SI_NO',\n            'orden': 4,\n            'obligatoria': False,\n            'importancia': 'MEDIA'\n        },\n        \n        # Dolor y Molestias\n        {\n            'categoria': dolor,\n            'texto': '¿Experimenta dolor dental actualmente?',\n            'tipo': 'SI_NO',\n            'orden': 1,\n            'obligatoria': True,\n            'importancia': 'ALTA'\n        },\n        {\n            'categoria': dolor,\n            'texto': '¿El dolor aumenta con alimentos fríos o calientes?',\n            'tipo': 'SI_NO',\n            'orden': 2,\n            'obligatoria': False,\n            'importancia': 'MEDIA'\n        },\n        {\n            'categoria': dolor,\n            'texto': '¿Siente molestias al masticar?',\n            'tipo': 'SI_NO',\n            'orden': 3,\n            'obligatoria': False,\n            'importancia': 'MEDIA'\n        },\n        \n        # Alergias y Medicamentos\n        {\n            'categoria': alergias,\n            'texto': '¿Es alérgico a algún medicamento?',\n            'subtitulo': 'Especifique cuáles y qué reacción produce',\n            'tipo': 'SI_NO',\n            'orden': 1,\n            'obligatoria': True,\n            'importancia': 'CRITICA',\n            'alerta_cofepris': True\n        },\n        {\n            'categoria': alergias,\n            'texto': '¿Toma algún medicamento actualmente?',\n            'subtitulo': 'Incluya medicamentos con y sin receta, suplementos',\n            'tipo': 'SI_NO',\n            'orden': 2,\n            'obligatoria': True,\n            'importancia': 'ALTA'\n        },\n        {\n            'categoria': alergias,\n            'texto': '¿Es alérgico al látex o algún material dental?',\n            'tipo': 'SI_NO',\n            'orden': 3,\n            'obligatoria': True,\n            'importancia': 'CRITICA',\n            'alerta_cofepris': True\n        },\n        \n        # Hábitos Orales\n        {\n            'categoria': habitos,\n            'texto': '¿Fuma cigarrillos o usa tabaco?',\n            'tipo': 'MULTIPLE',\n            'opciones': 'No fumo,Menos de 10 al día,10-20 al día,Más de 20 al día',\n            'orden': 1,\n            'obligatoria': True,\n            'importancia': 'ALTA'\n        },\n        {\n            'categoria': habitos,\n            'texto': '¿Consume bebidas alcohólicas regularmente?',\n            'tipo': 'MULTIPLE',\n            'opciones': 'No bebo,Ocasionalmente,Fines de semana,Diariamente',\n            'orden': 2,\n            'obligatoria': False,\n            'importancia': 'MEDIA'\n        },\n        {\n            'categoria': habitos,\n            'texto': '¿Con qué frecuencia se cepilla los dientes?',\n            'tipo': 'MULTIPLE',\n            'opciones': 'Menos de una vez al día,Una vez al día,Dos veces al día,Tres o más veces al día',\n            'orden': 3,\n            'obligatoria': True,\n            'importancia': 'MEDIA'\n        },\n        {\n            'categoria': habitos,\n            'texto': '¿Usa hilo dental regularmente?',\n            'tipo': 'SI_NO',\n            'orden': 4,\n            'obligatoria': False,\n            'importancia': 'BAJA'\n        }\n    ]\n    \n    for pregunta_data in preguntas:\n        pregunta, created = models.PreguntaHistorial.objects.get_or_create(\n            categoria=pregunta_data['categoria'],\n            texto=pregunta_data['texto'],\n            defaults=pregunta_data\n        )\n        if created:\n            print(f\"  ✓ Creada pregunta: {pregunta.texto[:50]}...\")\n        else:\n            print(f\"  - Ya existe: {pregunta.texto[:50]}...\")\n\ndef main():\n    \"\"\"Función principal\"\"\"\n    print(\"=\" * 60)\n    print(\"POBLANDO DATOS DEMO - HISTORIAL CLÍNICO MEJORADO\")\n    print(\"=\" * 60)\n    \n    try:\n        crear_categorias_historial()\n        crear_preguntas_historial()\n        \n        print(\"\\n\" + \"=\" * 60)\n        print(\"✅ DATOS DE DEMOSTRACIÓN CREADOS EXITOSAMENTE\")\n        print(\"=\" * 60)\n        print(\"\\nPuede ahora probar el historial clínico mejorado:\")\n        print(\"1. Vaya a cualquier paciente\")\n        print(\"2. Haga clic en 'Historial Clínico Mejorado'\")\n        print(\"3. Complete el formulario con las escalas de dolor\")\n        print(\"4. Explore las nuevas funcionalidades\")\n        print(\"\\n¡Disfrute del nuevo sistema!\")\n        \n    except Exception as e:\n        print(f\"\\n❌ ERROR: {e}\")\n        print(\"\\nVerifique que:\")\n        print(\"- Django esté configurado correctamente\")\n        print(\"- La base de datos esté accesible\")\n        print(\"- Los modelos estén migrados\")\n        sys.exit(1)\n\nif __name__ == '__main__':\n    main()