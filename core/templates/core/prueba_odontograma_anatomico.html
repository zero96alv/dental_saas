<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ titulo }}</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .header-prueba {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        .card-prueba {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .diagnosticos-panel {
            max-height: 400px;
            overflow-y: auto;
        }
        .btn-diagnostico {
            margin: 5px;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn-diagnostico:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .info-diente {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .alert-demo {
            border-radius: 15px;
            border: none;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header-prueba">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <h1 class="display-4 mb-3">ü¶∑ Odontogramas Profesionales - Prueba</h1>
                    <p class="lead">{{ descripcion }}</p>
                    
                    <!-- Selector de odontograma -->
                    <div class="btn-group flex-wrap" role="group" aria-label="Selector de odontograma">
                        <input type="radio" class="btn-check" name="odontograma-tipo" id="tipo-boca-abierta" value="boca-abierta" checked>
                        <label class="btn btn-outline-light" for="tipo-boca-abierta">
                            <i class="fas fa-teeth-open"></i> Boca Abierta Ovalada
                        </label>
                        
                        <input type="radio" class="btn-check" name="odontograma-tipo" id="tipo-fdi-universal" value="fdi-universal">
                        <label class="btn btn-outline-light" for="tipo-fdi-universal">
                            <i class="fas fa-th-large"></i> FDI Universal (Vista Oclusal)
                        </label>
                        
                        <input type="radio" class="btn-check" name="odontograma-tipo" id="tipo-clinico-profesional" value="clinico-profesional">
                        <label class="btn btn-outline-light" for="tipo-clinico-profesional">
                            <i class="fas fa-user-md"></i> Cl√≠nico Profesional
                        </label>
                        
                        <input type="radio" class="btn-check" name="odontograma-tipo" id="tipo-clinico-mejorado" value="clinico-mejorado">
                        <label class="btn btn-outline-light" for="tipo-clinico-mejorado">
                            <i class="fas fa-crown"></i> Cl√≠nico Mejorado
                        </label>
                        
                        <input type="radio" class="btn-check" name="odontograma-tipo" id="tipo-oclusal-anatomico" value="oclusal-anatomico">
                        <label class="btn btn-outline-light" for="tipo-oclusal-anatomico">
                            <i class="fas fa-eye"></i> Oclusal Anat√≥mico
                        </label>
                        
                        <input type="radio" class="btn-check" name="odontograma-tipo" id="tipo-3d-realista" value="3d-realista">
                        <label class="btn btn-outline-light" for="tipo-3d-realista">
                            <i class="fas fa-cube"></i> 3D Ultra Realista
                        </label>
                    </div>
                    <div class="alert alert-warning alert-demo d-inline-block">
                        ‚ö†Ô∏è <strong>MODO PRUEBA</strong> - Esta p√°gina es solo para evaluar el dise√±o
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Panel de diagn√≥sticos -->
            <div class="col-lg-3 col-md-4">
                <div class="card card-prueba">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üîß Panel de Diagn√≥sticos</h5>
                    </div>
                    <div class="card-body diagnosticos-panel">
                        <p class="text-muted small">Selecciona un diente del odontograma y luego un diagn√≥stico:</p>
                        
                        <div class="d-grid gap-2">
                            <button class="btn btn-success btn-diagnostico" data-diagnostico="sano">
                                ‚úÖ Sano
                            </button>
                            <button class="btn btn-danger btn-diagnostico" data-diagnostico="caries">
                                ü¶† Caries
                            </button>
                            <button class="btn btn-warning btn-diagnostico" data-diagnostico="obturada">
                                üü° Obturada
                            </button>
                            <button class="btn btn-info btn-diagnostico" data-diagnostico="corona">
                                üëë Corona
                            </button>
                            <button class="btn btn-secondary btn-diagnostico" data-diagnostico="extraida">
                                ‚ùå Extra√≠da
                            </button>
                            <button class="btn btn-primary btn-diagnostico" data-diagnostico="implante">
                                üîß Implante
                            </button>
                            <button class="btn" style="background-color: #e83e8c; color: white;" data-diagnostico="endodoncia">
                                üè• Endodoncia
                            </button>
                        </div>

                        <div class="info-diente" id="info-diente" style="display: none;">
                            <h6 class="text-primary">Diente Seleccionado:</h6>
                            <p id="diente-info-texto" class="mb-0">Ninguno</p>
                        </div>

                        <hr>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-success" id="btn-guardar-demo" disabled>
                                üíæ Guardar Cambios (Demo)
                            </button>
                            <button class="btn btn-outline-secondary" id="btn-limpiar-demo">
                                üßπ Limpiar Selecci√≥n
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Panel de informaci√≥n del paciente -->
                <div class="card card-prueba">
                    <div class="card-header bg-info text-white">
                        <h6 class="mb-0">üë§ Paciente Demo</h6>
                    </div>
                    <div class="card-body">
                        <p><strong>Nombre:</strong> {{ paciente_demo.nombre }}</p>
                        <p class="mb-0"><strong>ID:</strong> {{ paciente_demo.numero_identificacion }}</p>
                    </div>
                </div>
            </div>

            <!-- Odontograma -->
            <div class="col-lg-9 col-md-8">
                <div class="card card-prueba">
                    <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 odontograma-title">ü¶∑ Odontograma - Boca Abierta Ovalada</h5>
                        <small class="text-light odontograma-descripcion">Vista anat√≥mica realista</small>
                    </div>
                    <div class="card-body p-0">
                        
                        <!-- Contenedor del odontograma de boca abierta -->
                        <div id="odontograma-boca-abierta" class="odontograma-container">
                            {% include 'core/partials/odontograma_boca_abierta.html' %}
                        </div>
                        
                        <!-- Contenedor del odontograma FDI Universal -->
                        <div id="odontograma-fdi-universal" class="odontograma-container" style="display: none;">
                            {% include 'core/partials/odontograma_fdi_universal.html' %}
                        </div>
                        
                        <!-- Contenedor del odontograma Cl√≠nico Profesional -->
                        <div id="odontograma-clinico-profesional" class="odontograma-container" style="display: none;">
                            {% include 'core/partials/odontograma_clinico_exacto.html' %}
                        </div>
                        
                        <!-- Contenedor del odontograma Cl√≠nico Mejorado -->
                        <div id="odontograma-clinico-mejorado" class="odontograma-container" style="display: none;">
                            {% include 'core/partials/odontograma_clinico_mejorado.html' %}
                        </div>
                        
                        <!-- Contenedor del odontograma Oclusal Anat√≥mico -->
                        <div id="odontograma-oclusal-anatomico" class="odontograma-container" style="display: none;">
                            {% include 'core/partials/odontograma_oclusal_anatomico.html' %}
                        </div>
                        
                        <!-- Contenedor del odontograma 3D Ultra Realista -->
                        <div id="odontograma-3d-realista" class="odontograma-container" style="display: none;">
                            {% include 'core/partials/odontograma_3d_realista.html' %}
                        </div>
                        
                        <!-- Panel de instrucciones -->
                        <div class="alert alert-info alert-demo m-3">
                            <h6>üìã Instrucciones de prueba:</h6>
                            <div class="instrucciones-boca-abierta">
                                <ol class="mb-0">
                                    <li>Selecciona el tipo de odontograma en el header</li>
                                    <li>Haz clic en cualquier diente del odontograma</li>
                                    <li>Selecciona un diagn√≥stico del panel izquierdo</li>
                                    <li>Observa como cambia el color del diente</li>
                                    <li>Haz clic en "Guardar Cambios" para probar la funcionalidad</li>
                                </ol>
                            </div>
                            <div class="instrucciones-fdi-universal" style="display: none;">
                                <ol class="mb-0">
                                    <li><strong>Vista Oclusal FDI:</strong> Perspectiva desde arriba como en el consultorio</li>
                                    <li><strong>Cuadrantes:</strong> Divisi√≥n clara con l√≠neas centrales</li>
                                    <li><strong>Numeraci√≥n:</strong> Sistema de dos d√≠gitos (cuadrante + posici√≥n)</li>
                                    <li>Haz clic en cualquier diente para ver informaci√≥n detallada</li>
                                    <li>Aplica diagn√≥sticos usando el panel lateral</li>
                                </ol>
                            </div>
                            <div class="instrucciones-clinico-profesional" style="display: none;">
                                <ol class="mb-0">
                                    <li><strong>Dise√±o Cl√≠nico:</strong> R√©plica exacta del formato profesional usado en cl√≠nicas</li>
                                    <li><strong>Paneles Laterales:</strong> Espacios para anotaciones por cuadrante</li>
                                    <li><strong>Superficies Oclusales:</strong> Representaci√≥n real de la anatom√≠a dental</li>
                                    <li><strong>L√≠neas de C√∫spides:</strong> Detalles anat√≥micos en molares y premolares</li>
                                    <li>Formato id√©ntico al usado en historias cl√≠nicas reales</li>
                                </ol>
                            </div>
                            <div class="instrucciones-clinico-mejorado" style="display: none;">
                                <ol class="mb-0">
                                    <li><strong>Dise√±o Limpio:</strong> Odontograma cl√≠nico sin paneles laterales, m√°s enfocado</li>
                                    <li><strong>Formas Anat√≥micas:</strong> Dientes con formas realistas por tipo (incisivos, caninos, premolares, molares)</li>
                                    <li><strong>Enc√≠as Naturales:</strong> Representaci√≥n realista de la forma de herradura de la boca</li>
                                    <li><strong>Vista Oclusal:</strong> Perspectiva desde arriba como ve el dentista durante el examen</li>
                                    <li><strong>C√∫spides Detalladas:</strong> L√≠neas anat√≥micas en molares y premolares para mayor realismo</li>
                                    <li>Dise√±o profesional optimizado para mejor visualizaci√≥n y usabilidad</li>
                                </ol>
                            </div>
                            <div class="instrucciones-oclusal-anatomico" style="display: none;">
                                <ol class="mb-0">
                                    <li><strong>üëÅÔ∏è Vista Oclusal Real:</strong> Reproducci√≥n exacta de lo que ve el dentista al mirar desde arriba</li>
                                    <li><strong>ü¶∑ Anatom√≠a Aut√©ntica:</strong> Cada diente tiene su forma oclusal espec√≠fica seg√∫n su tipo</li>
                                    <li><strong>üï∞Ô∏è C√∫spides Reales:</strong> Molares con m√∫ltiples c√∫spides, premolares ovalados, caninos puntiagudos</li>
                                    <li><strong>üåÄ Fisuras Centrales:</strong> L√≠neas anat√≥micas internas que muestran la morfolog√≠a real</li>
                                    <li><strong>üì∞ Proporciones Correctas:</strong> Tama√±os relativos reales entre incisivos, premolares y molares</li>
                                    <li><strong>üé® Gradientes Naturales:</strong> Enc√≠as con textura y coloraci√≥n realista</li>
                                    <li>Dise√±o fiel a la anatom√≠a dental como se ve en ex√°menes cl√≠nicos reales</li>
                                </ol>
                            </div>
                            <div class="instrucciones-3d-realista" style="display: none;">
                                <ol class="mb-0">
                                    <li><strong>üé® Efectos 3D:</strong> Gradientes radiales y sombras que simulan profundidad y relieve real</li>
                                    <li><strong>ü•å Proporciones Exactas:</strong> Arcadas con forma de herradura anat√≥micamente correcta</li>
                                    <li><strong>üåà Colores Naturales:</strong> Tonos beige/crema que replican el color real de los dientes</li>
                                    <li><strong>‚ú® Molares Complejos:</strong> M√∫ltiples c√∫spides con fisuras centrales y secundarias detalladas</li>
                                    <li><strong>üî∂ Caninos Puntiagudos:</strong> Formas triangulares realistas con c√∫spides prominentes</li>
                                    <li><strong>üü¢ Premolares Ovalados:</strong> Formas el√≠pticas con dos c√∫spides principales</li>
                                    <li><strong>üó™Ô∏è Incisivos Rectangulares:</strong> Bordes incisales realistas con proporciones correctas</li>
                                    <li><strong>üéØ Tama√±os Correctos:</strong> Molares m√°s grandes, premolares medianos, incisivos m√°s peque√±os</li>
                                    <li>M√°ximo nivel de realismo visual - Como ver dientes reales desde arriba</li>
                                </ol>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Log de eventos -->
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card card-prueba">
                    <div class="card-header bg-dark text-white">
                        <h6 class="mb-0">üìù Log de Eventos (Consola de Prueba)</h6>
                    </div>
                    <div class="card-body">
                        <div id="log-eventos" class="bg-dark text-light p-3" style="height: 200px; overflow-y: auto; font-family: monospace; font-size: 0.9rem; border-radius: 5px;">
                            <div class="text-success">[SISTEMA] P√°gina de prueba iniciada - observa la consola del navegador para m√°s detalles</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    (function() {
        'use strict';
        
        let dienteSeleccionado = null;
        let cambiosPendientes = {};
        let tipoOdontogramaActual = 'boca-abierta';
        
        function cambiarOdontograma(tipo) {
            const bocaAbierta = document.getElementById('odontograma-boca-abierta');
            const fdiUniversal = document.getElementById('odontograma-fdi-universal');
            const clinicoProfesional = document.getElementById('odontograma-clinico-profesional');
            const clinicoMejorado = document.getElementById('odontograma-clinico-mejorado');
            const oclusalAnatomico = document.getElementById('odontograma-oclusal-anatomico');
            const realista3D = document.getElementById('odontograma-3d-realista');
            const titulo = document.querySelector('.odontograma-title');
            const descripcion = document.querySelector('.odontograma-descripcion');
            const instruccionesBoca = document.querySelector('.instrucciones-boca-abierta');
            const instruccionesFDI = document.querySelector('.instrucciones-fdi-universal');
            const instruccionesClinico = document.querySelector('.instrucciones-clinico-profesional');
            const instruccionesMejorado = document.querySelector('.instrucciones-clinico-mejorado');
            const instruccionesAnatomico = document.querySelector('.instrucciones-oclusal-anatomico');
            const instrucciones3D = document.querySelector('.instrucciones-3d-realista');
            
            tipoOdontogramaActual = tipo;
            
            if (tipo === 'boca-abierta') {
                bocaAbierta.style.display = 'block';
                fdiUniversal.style.display = 'none';
                clinicoProfesional.style.display = 'none';
                clinicoMejorado.style.display = 'none';
                oclusalAnatomico.style.display = 'none';
                realista3D.style.display = 'none';
                titulo.textContent = 'ü•∑ Odontograma - Boca Abierta Ovalada';
                descripcion.textContent = 'Vista anat√≥mica realista';
                instruccionesBoca.style.display = 'block';
                instruccionesFDI.style.display = 'none';
                instruccionesClinico.style.display = 'none';
                instruccionesMejorado.style.display = 'none';
                instruccionesAnatomico.style.display = 'none';
                instrucciones3D.style.display = 'none';
                log('üîÑ Cambiado a odontograma de Boca Abierta Ovalada', 'info');
            } else if (tipo === 'fdi-universal') {
                bocaAbierta.style.display = 'none';
                fdiUniversal.style.display = 'block';
                clinicoProfesional.style.display = 'none';
                clinicoMejorado.style.display = 'none';
                oclusalAnatomico.style.display = 'none';
                realista3D.style.display = 'none';
                titulo.innerHTML = 'ü•∑ Odontograma - Sistema FDI Universal';
                descripcion.textContent = 'Vista oclusal con cuadrantes';
                instruccionesBoca.style.display = 'none';
                instruccionesFDI.style.display = 'block';
                instruccionesClinico.style.display = 'none';
                instruccionesMejorado.style.display = 'none';
                instruccionesAnatomico.style.display = 'none';
                instrucciones3D.style.display = 'none';
                log('üîÑ Cambiado a odontograma FDI Universal', 'info');
            } else if (tipo === 'clinico-profesional') {
                bocaAbierta.style.display = 'none';
                fdiUniversal.style.display = 'none';
                clinicoProfesional.style.display = 'block';
                clinicoMejorado.style.display = 'none';
                oclusalAnatomico.style.display = 'none';
                realista3D.style.display = 'none';
                titulo.innerHTML = 'ü•∑ Odontograma - Cl√≠nico Profesional';
                descripcion.textContent = 'Formato cl√≠nico est√°ndar';
                instruccionesBoca.style.display = 'none';
                instruccionesFDI.style.display = 'none';
                instruccionesClinico.style.display = 'block';
                instruccionesMejorado.style.display = 'none';
                instruccionesAnatomico.style.display = 'none';
                instrucciones3D.style.display = 'none';
                log('üîÑ Cambiado a odontograma Cl√≠nico Profesional', 'info');
            } else if (tipo === 'clinico-mejorado') {
                bocaAbierta.style.display = 'none';
                fdiUniversal.style.display = 'none';
                clinicoProfesional.style.display = 'none';
                clinicoMejorado.style.display = 'block';
                oclusalAnatomico.style.display = 'none';
                realista3D.style.display = 'none';
                titulo.innerHTML = 'ü•∑ Odontograma - Cl√≠nico Mejorado';
                descripcion.textContent = 'Vista oclusal anat√≥mica sin paneles';
                instruccionesBoca.style.display = 'none';
                instruccionesFDI.style.display = 'none';
                instruccionesClinico.style.display = 'none';
                instruccionesMejorado.style.display = 'block';
                instruccionesAnatomico.style.display = 'none';
                instrucciones3D.style.display = 'none';
                log('üîÑ Cambiado a odontograma Cl√≠nico Mejorado', 'info');
            } else if (tipo === 'oclusal-anatomico') {
                bocaAbierta.style.display = 'none';
                fdiUniversal.style.display = 'none';
                clinicoProfesional.style.display = 'none';
                clinicoMejorado.style.display = 'none';
                oclusalAnatomico.style.display = 'block';
                realista3D.style.display = 'none';
                titulo.innerHTML = 'ü•∑ Odontograma - Oclusal Anat√≥mico Real';
                descripcion.textContent = 'Vista desde arriba con anatom√≠a dental realista';
                instruccionesBoca.style.display = 'none';
                instruccionesFDI.style.display = 'none';
                instruccionesClinico.style.display = 'none';
                instruccionesMejorado.style.display = 'none';
                instruccionesAnatomico.style.display = 'block';
                instrucciones3D.style.display = 'none';
                log('üîÑ Cambiado a odontograma Oclusal Anat√≥mico Real', 'info');
            } else if (tipo === '3d-realista') {
                bocaAbierta.style.display = 'none';
                fdiUniversal.style.display = 'none';
                clinicoProfesional.style.display = 'none';
                clinicoMejorado.style.display = 'none';
                oclusalAnatomico.style.display = 'none';
                realista3D.style.display = 'block';
                titulo.innerHTML = 'ü•∑ Odontograma - 3D Ultra Realista';
                descripcion.textContent = 'Vista oclusal con efectos 3D y gradientes naturales';
                instruccionesBoca.style.display = 'none';
                instruccionesFDI.style.display = 'none';
                instruccionesClinico.style.display = 'none';
                instruccionesMejorado.style.display = 'none';
                instruccionesAnatomico.style.display = 'none';
                instrucciones3D.style.display = 'block';
                log('üîÑ Cambiado a odontograma 3D Ultra Realista', 'info');
            }
            
            // Limpiar selecci√≥n al cambiar
            limpiarSeleccion();
        }
        
        function limpiarSeleccion() {
            // Limpiar selecci√≥n en todos los tipos de odontograma
            document.querySelectorAll('.diente-u, .diente-fdi, .diente-clinico, .diente-real, .diente-mejorado, .diente-anatomico, .diente-3d').forEach(d => {
                d.classList.remove('selected');
            });
            
            dienteSeleccionado = null;
            
            // Ocultar info del diente
            const infoDiv = document.getElementById('info-diente');
            if (infoDiv) {
                infoDiv.style.display = 'none';
            }
            
            // Deshabilitar botones
            document.querySelectorAll('.btn-diagnostico').forEach(btn => {
                btn.disabled = true;
            });
            
            log('üßπ Selecci√≥n limpiada', 'info');
        }
        
        function log(mensaje, tipo = 'info') {
            console.log(`[PRUEBA ODONTOGRAMA] ${mensaje}`);
            
            const logDiv = document.getElementById('log-eventos');
            if (logDiv) {
                const colores = {
                    'info': 'text-info',
                    'success': 'text-success', 
                    'warning': 'text-warning',
                    'error': 'text-danger'
                };
                
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = colores[tipo] || 'text-light';
                logEntry.innerHTML = `[${timestamp}] ${mensaje}`;
                
                logDiv.appendChild(logEntry);
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Iniciando p√°gina de prueba de odontogramas profesionales', 'success');
            
            // Event listeners para el selector de odontogramas
            document.querySelectorAll('input[name="odontograma-tipo"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        cambiarOdontograma(this.value);
                    }
                });
            });
            
            // Escuchar eventos del odontograma FDI
            document.addEventListener('dienteFDISeleccionado', function(e) {
                const info = e.detail;
                dienteSeleccionado = {
                    numero: info.numeroFDI,
                    tipo: info.tipoDiente,
                    elemento: info.elemento
                };
                
                log(`ü¶∑ Diente FDI seleccionado: ${info.numeroFDI} (${info.tipoDiente}, Cuadrante ${info.cuadrante})`, 'info');
                
                // Mostrar informaci√≥n del diente
                const infoDiv = document.getElementById('info-diente');
                const textoInfo = document.getElementById('diente-info-texto');
                if (infoDiv && textoInfo) {
                    infoDiv.style.display = 'block';
                    textoInfo.textContent = `Diente FDI ${info.numeroFDI} (${info.tipoDiente})`;
                }
                
                // Habilitar botones de diagn√≥stico
                document.querySelectorAll('.btn-diagnostico').forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('disabled');
                });
            });
            
            // Escuchar eventos del odontograma Cl√≠nico Exacto
            document.addEventListener('dienteExactoSeleccionado', function(e) {
                const info = e.detail;
                dienteSeleccionado = {
                    numero: info.numeroFDI,
                    tipo: info.tipoDiente,
                    elemento: info.elemento
                };
                
                log(`ü•∑ Diente Cl√≠nico Exacto seleccionado: ${info.numeroFDI} (${info.tipoDiente}, Cuadrante ${info.cuadrante})`, 'info');
                
                // Mostrar informaci√≥n del diente
                const infoDiv = document.getElementById('info-diente');
                const textoInfo = document.getElementById('diente-info-texto');
                if (infoDiv && textoInfo) {
                    infoDiv.style.display = 'block';
                    textoInfo.textContent = `Diente Cl√≠nico ${info.numeroFDI} (${info.tipoDiente})`;
                }
                
                // Habilitar botones de diagn√≥stico
                document.querySelectorAll('.btn-diagnostico').forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('disabled');
                });
            });
            
            // Escuchar eventos del odontograma Cl√≠nico Mejorado
            document.addEventListener('dienteMejoradoSeleccionado', function(e) {
                const info = e.detail;
                dienteSeleccionado = {
                    numero: info.numeroFDI,
                    tipo: info.tipoDiente,
                    elemento: info.elemento
                };
                
                log(`ü•∑ Diente Cl√≠nico Mejorado seleccionado: ${info.numeroFDI} (${info.tipoDiente}, Cuadrante ${info.cuadrante})`, 'info');
                
                // Mostrar informaci√≥n del diente
                const infoDiv = document.getElementById('info-diente');
                const textoInfo = document.getElementById('diente-info-texto');
                if (infoDiv && textoInfo) {
                    infoDiv.style.display = 'block';
                    textoInfo.textContent = `Diente Mejorado ${info.numeroFDI} (${info.tipoDiente})`;
                }
                
                // Habilitar botones de diagn√≥stico
                document.querySelectorAll('.btn-diagnostico').forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('disabled');
                });
            });
            
            // Escuchar eventos del odontograma Oclusal Anat√≥mico
            document.addEventListener('dienteAnatomico‚ÄãSeleccionado', function(e) {
                const info = e.detail;
                dienteSeleccionado = {
                    numero: info.numeroFDI,
                    tipo: info.tipoDiente,
                    elemento: info.elemento
                };
                
                log(`ü•∑ Diente Oclusal Anat√≥mico seleccionado: ${info.numeroFDI} (${info.tipoDiente}, ${info.tipoAnatomico})`, 'info');
                
                // Mostrar informaci√≥n del diente
                const infoDiv = document.getElementById('info-diente');
                const textoInfo = document.getElementById('diente-info-texto');
                if (infoDiv && textoInfo) {
                    infoDiv.style.display = 'block';
                    textoInfo.textContent = `Diente Anat√≥mico ${info.numeroFDI} (${info.tipoDiente})`;
                }
                
                // Habilitar botones de diagn√≥stico
                document.querySelectorAll('.btn-diagnostico').forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('disabled');
                });
            });
            
            // Escuchar eventos del odontograma 3D Realista
            document.addEventListener('diente3DRealistaSeleccionado', function(e) {
                const info = e.detail;
                dienteSeleccionado = {
                    numero: info.numeroFDI,
                    tipo: info.tipoDiente,
                    elemento: info.elemento
                };
                
                log(`ü•∑ Diente 3D Realista seleccionado: ${info.numeroFDI} (${info.tipoDiente}, ${info.tipoAnatomico3D})`, 'info');
                
                // Mostrar informaci√≥n del diente
                const infoDiv = document.getElementById('info-diente');
                const textoInfo = document.getElementById('diente-info-texto');
                if (infoDiv && textoInfo) {
                    infoDiv.style.display = 'block';
                    textoInfo.textContent = `Diente 3D ${info.numeroFDI} (${info.tipoDiente})`;
                }
                
                // Habilitar botones de diagn√≥stico
                document.querySelectorAll('.btn-diagnostico').forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('disabled');
                });
            });
            
            // Aplicar diagn√≥sticos demo iniciales
            const diagnosticosDemo = JSON.parse('{{ diagnosticos_demo|escapejs }}');
            setTimeout(() => {
                diagnosticosDemo.forEach(demo => {
                    const elemento = document.getElementById(`diente-${demo.numero}`);
                    if (elemento) {
                        elemento.classList.add(demo.diagnostico);
                        log(`‚úÖ Diagn√≥stico demo aplicado: Diente ${demo.numero} -> ${demo.diagnostico}`, 'success');
                    }
                });
            }, 500);
            
            // Escuchar selecci√≥n de dientes
            document.addEventListener('dienteSeleccionado', function(e) {
                dienteSeleccionado = e.detail;
                log(`ü¶∑ Diente seleccionado: ${dienteSeleccionado.numero} (${dienteSeleccionado.tipo})`, 'info');
                
                // Mostrar informaci√≥n del diente
                const infoDiv = document.getElementById('info-diente');
                const textoInfo = document.getElementById('diente-info-texto');
                if (infoDiv && textoInfo) {
                    infoDiv.style.display = 'block';
                    textoInfo.textContent = `Diente #${dienteSeleccionado.numero}`;
                }
                
                // Habilitar botones de diagn√≥stico
                document.querySelectorAll('.btn-diagnostico').forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('disabled');
                });
            });
            
            // Manejar clics en diagn√≥sticos
            document.querySelectorAll('.btn-diagnostico').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!dienteSeleccionado) {
                        log('‚ö†Ô∏è Debes seleccionar un diente primero', 'warning');
                        return;
                    }
                    
                    const diagnostico = this.getAttribute('data-diagnostico');
                    log(`üîß Aplicando diagn√≥stico: ${diagnostico} al diente ${dienteSeleccionado.numero}`, 'info');
                    
                    // Aplicar diagn√≥stico seg√∫n el tipo de odontograma
                    if (tipoOdontogramaActual === 'fdi-universal') {
                        // Usar la funci√≥n global del odontograma FDI
                        if (window.aplicarDiagnosticoFDI) {
                            window.aplicarDiagnosticoFDI(dienteSeleccionado.numero, diagnostico);
                        }
                    } else if (tipoOdontogramaActual === 'clinico-profesional') {
                        // Usar la funci√≥n global del odontograma Cl√≠nico Exacto
                        if (window.aplicarDiagnosticoExacto) {
                            window.aplicarDiagnosticoExacto(dienteSeleccionado.numero, diagnostico);
                        }
                    } else if (tipoOdontogramaActual === 'clinico-mejorado') {
                        // Usar la funci√≥n global del odontograma Cl√≠nico Mejorado
                        if (window.aplicarDiagnosticoMejorado) {
                            window.aplicarDiagnosticoMejorado(dienteSeleccionado.numero, diagnostico);
                        }
                    } else if (tipoOdontogramaActual === 'oclusal-anatomico') {
                        // Usar la funci√≥n global del odontograma Oclusal Anat√≥mico
                        if (window.aplicarDiagnosticoAnatomico) {
                            window.aplicarDiagnosticoAnatomico(dienteSeleccionado.numero, diagnostico);
                        }
                    } else if (tipoOdontogramaActual === '3d-realista') {
                        // Usar la funci√≥n global del odontograma 3D Realista
                        if (window.aplicarDiagnostico3D) {
                            window.aplicarDiagnostico3D(dienteSeleccionado.numero, diagnostico);
                        }
                    } else {
                        // Aplicar diagn√≥stico al odontograma de boca abierta
                        const elemento = dienteSeleccionado.elemento;
                        elemento.classList.remove('sano', 'caries', 'obturada', 'corona', 'extraida', 'implante', 'endodoncia');
                        elemento.classList.add(diagnostico);
                    }
                    
                    // Registrar cambio
                    cambiosPendientes[dienteSeleccionado.numero] = diagnostico;
                    
                    log(`‚úÖ Diagn√≥stico aplicado visualmente: Diente ${dienteSeleccionado.numero} -> ${diagnostico}`, 'success');
                    
                    // Habilitar bot√≥n guardar
                    const btnGuardar = document.getElementById('btn-guardar-demo');
                    if (btnGuardar) {
                        btnGuardar.disabled = false;
                        btnGuardar.classList.remove('disabled');
                    }
                });
            });
            
            // Bot√≥n guardar demo
            document.getElementById('btn-guardar-demo').addEventListener('click', function() {
                if (Object.keys(cambiosPendientes).length === 0) {
                    log('‚ö†Ô∏è No hay cambios para guardar', 'warning');
                    return;
                }
                
                log(`üíæ Guardando ${Object.keys(cambiosPendientes).length} cambios...`, 'info');
                
                // Simular guardado
                setTimeout(() => {
                    log(`‚úÖ Cambios guardados exitosamente (DEMO): ${JSON.stringify(cambiosPendientes)}`, 'success');
                    cambiosPendientes = {};
                    this.disabled = true;
                }, 1000);
            });
            
            // Bot√≥n limpiar
            document.getElementById('btn-limpiar-demo').addEventListener('click', function() {
                if (tipoOdontogramaActual === 'fdi-universal') {
                    // Usar la funci√≥n global del odontograma FDI
                    if (window.limpiarSeleccionFDI) {
                        window.limpiarSeleccionFDI();
                    }
                } else if (tipoOdontogramaActual === 'clinico-profesional') {
                    // Usar la funci√≥n global del odontograma Cl√≠nico Exacto
                    if (window.limpiarSeleccionExacto) {
                        window.limpiarSeleccionExacto();
                    }
                } else if (tipoOdontogramaActual === 'clinico-mejorado') {
                    // Usar la funci√≥n global del odontograma Cl√≠nico Mejorado
                    if (window.limpiarSeleccionMejorado) {
                        window.limpiarSeleccionMejorado();
                    }
                } else if (tipoOdontogramaActual === 'oclusal-anatomico') {
                    // Usar la funci√≥n global del odontograma Oclusal Anat√≥mico
                    if (window.limpiarSeleccionAnatomico) {
                        window.limpiarSeleccionAnatomico();
                    }
                } else if (tipoOdontogramaActual === '3d-realista') {
                    // Usar la funci√≥n global del odontograma 3D Realista
                    if (window.limpiarSeleccion3D) {
                        window.limpiarSeleccion3D();
                    }
                } else {
                    // Limpiar odontograma de boca abierta
                    document.querySelectorAll('.diente-u').forEach(d => {
                        d.classList.remove('selected', 'sano', 'caries', 'obturada', 'corona', 'extraida', 'implante', 'endodoncia');
                    });
                }
                
                limpiarSeleccion();
            });
            
            log('üéØ Sistema de prueba listo - haz clic en cualquier diente para empezar', 'success');
        });
    })();
    </script>
</body>
</html>