{% extends 'core/base.html' %}
{% load crispy_forms_tags %}

{% block title %}{% if 'edit' in request.path %}Editar Paciente{% else %}Crear Paciente{% endif %}{% endblock %}

{% block content %}
    <h1>{% if 'edit' in request.path %}Editar Paciente{% else %}Crear Paciente{% endif %}</h1>
    
    <form method="post" novalidate>
        {% csrf_token %}
        <div class="card mb-3">
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">{{ form.nombre|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.apellido|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.email|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.telefono|as_crispy_field }}</div>
                    <div class="col-md-4">{{ form.fecha_nacimiento|as_crispy_field }}</div>
                </div>
            </div>
        </div>
        <div class="card mb-3">
            <div class="card-header">Dirección</div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">{{ form.calle|as_crispy_field }}</div>
                    <div class="col-md-3">{{ form.numero_exterior|as_crispy_field }}</div>
                    <div class="col-md-3">{{ form.codigo_postal|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.colonia|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.municipio|as_crispy_field }}</div>
                    <div class="col-md-6">{{ form.estado|as_crispy_field }}</div>
                </div>
            </div>
        </div>
        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-success">Guardar</button>
            <a href="{% url 'core:paciente_list' %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>

    {% block extra_js %}
    <script>
        // Máscara básica para teléfono y validación de CP
        document.addEventListener('DOMContentLoaded', function() {
            const tel = document.getElementById('id_telefono');
            if (tel) {
                tel.addEventListener('input', function() {
                    this.value = this.value.replace(/[^\d\s+\-]/g, '');
                });
            }
            const cp = document.getElementById('id_codigo_postal');
            if (cp) {
                cp.addEventListener('input', function(){
                    this.value = this.value.replace(/[^\d]/g, '').slice(0,5);
                });
            }
        });
    </script>
    {% endblock %}
{% endblock %}