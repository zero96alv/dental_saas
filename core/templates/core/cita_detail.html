{% extends "core/base.html" %}
{% load tenant_urls %}

{% block title %}Detalles de Cita #{{ cita.id }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2><i class="bi bi-calendar-check me-2"></i> Detalles de Cita #{{ cita.id }}</h2>
        <a href="{% tenant_url 'core:pago_list' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left me-1"></i> Volver a Pagos
        </a>
    </div>

    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Información de la Cita</h5>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Paciente:</strong> 
                        <a href="{% tenant_url 'core:paciente_detail' pk=cita.paciente.id %}">{{ cita.paciente }}</a>
                    </p>
                    <p><strong>Dentista:</strong> {{ cita.dentista }}</p>
                    <p><strong>Unidad Dental:</strong> {{ cita.unidad_dental }}</p>
                    <p><strong>Fecha y Hora:</strong> {{ cita.fecha_hora|date:"d/m/Y H:i" }}</p>
                    <p><strong>Estado:</strong> {{ cita.get_estado_display }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Costo Estimado:</strong> ${{ cita.costo_estimado|floatformat:2 }}</p>
                    <p><strong>Costo Real:</strong> ${{ cita.costo_real|floatformat:2 }}</p>
                    <p><strong>Total Pagado:</strong> ${{ cita.total_pagado|floatformat:2 }}</p>
                    <p><strong>Saldo Pendiente:</strong> ${{ cita.saldo_pendiente|floatformat:2 }}</p>
                    <p><strong>Requiere Factura:</strong> {% if cita.requiere_factura %}Sí{% else %}No{% endif %}</p>
                </div>
            </div>

            <h5 class="mt-4">Servicios Planeados</h5>
            <ul class="list-group mb-3">
                {% for servicio in cita.servicios_planeados.all %}
                    <li class="list-group-item">{{ servicio.nombre }} - ${{ servicio.precio|floatformat:2 }}</li>
                {% empty %}
                    <li class="list-group-item">No hay servicios planeados.</li>
                {% endfor %}
            </ul>

            <h5>Servicios Realizados</h5>
            <ul class="list-group mb-3">
                {% for servicio in cita.servicios_realizados %}
                    <li class="list-group-item">{{ servicio.nombre }} - ${{ servicio.precio|floatformat:2 }}</li>
                {% empty %}
                    <li class="list-group-item">No hay servicios realizados.</li>
                {% endfor %}
            </ul>

            <h5>Notas</h5>
            <p>{{ cita.notas|default:"Sin notas." }}</p>

            <div class="d-flex justify-content-end">
                <a href="{% tenant_url 'core:cita_cambiar_estado' pk=cita.id %}" class="btn btn-primary me-2">
                    <i class="bi bi-arrow-repeat me-1"></i> Cambiar Estado
                </a>
                <a href="{% tenant_url 'core:cita_finalizar' pk=cita.id %}" class="btn btn-success">
                    <i class="bi bi-check-circle me-1"></i> Finalizar Cita
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}