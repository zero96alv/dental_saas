{% load math_filters %}
<div id="odontograma-fdi-universal" class="odontograma-fdi-universal">
    <style>
        .odontograma-fdi-universal {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .odontograma-fdi-universal svg {
            width: 100%;
            height: auto;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 
                inset 0 2px 8px rgba(0,0,0,0.05),
                0 4px 16px rgba(0,0,0,0.08);
            border: 2px solid #dee2e6;
        }
        
        /* Líneas de división de cuadrantes */
        .linea-cuadrante {
            stroke: #495057;
            stroke-width: 2;
            opacity: 0.8;
        }
        
        .linea-cuadrante-principal {
            stroke: #343a40;
            stroke-width: 3;
            opacity: 0.9;
        }
        
        /* Dientes FDI */
        .diente-fdi {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .diente-fdi:hover {
            filter: drop-shadow(0 0 8px rgba(0, 123, 255, 0.7));
            transform: scale(1.05);
        }
        
        .diente-fdi.selected {
            filter: drop-shadow(0 0 12px rgba(255, 193, 7, 1));
            transform: scale(1.08);
        }
        
        /* Formas de coronas por tipo de diente */
        .corona-incisivo {
            fill: #ffffff;
            stroke: #495057;
            stroke-width: 1.5;
        }
        
        .corona-canino {
            fill: #f8f9fa;
            stroke: #495057;
            stroke-width: 1.5;
        }
        
        .corona-premolar {
            fill: #ffffff;
            stroke: #495057;
            stroke-width: 1.5;
        }
        
        .corona-molar {
            fill: #f8f9fa;
            stroke: #495057;
            stroke-width: 1.8;
        }
        
        /* Numeración FDI */
        .numero-fdi {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 11px;
            font-weight: bold;
            fill: #212529;
            text-anchor: middle;
            dominant-baseline: central;
            pointer-events: none;
        }
        
        /* Estados de diagnóstico FDI */
        .diente-fdi.sano .corona-incisivo,
        .diente-fdi.sano .corona-canino,
        .diente-fdi.sano .corona-premolar,
        .diente-fdi.sano .corona-molar { 
            fill: #28a745;
            stroke: #155724;
        }
        
        .diente-fdi.caries .corona-incisivo,
        .diente-fdi.caries .corona-canino,
        .diente-fdi.caries .corona-premolar,
        .diente-fdi.caries .corona-molar { 
            fill: #dc3545;
            stroke: #721c24;
        }
        
        .diente-fdi.obturada .corona-incisivo,
        .diente-fdi.obturada .corona-canino,
        .diente-fdi.obturada .corona-premolar,
        .diente-fdi.obturada .corona-molar { 
            fill: #fd7e14;
            stroke: #a0440e;
        }
        
        .diente-fdi.corona .corona-incisivo,
        .diente-fdi.corona .corona-canino,
        .diente-fdi.corona .corona-premolar,
        .diente-fdi.corona .corona-molar { 
            fill: #007bff;
            stroke: #004085;
        }
        
        .diente-fdi.extraida .corona-incisivo,
        .diente-fdi.extraida .corona-canino,
        .diente-fdi.extraida .corona-premolar,
        .diente-fdi.extraida .corona-molar { 
            fill: #6c757d;
            stroke: #343a40;
            stroke-dasharray: 4,3;
            opacity: 0.6;
        }
        
        .diente-fdi.implante .corona-incisivo,
        .diente-fdi.implante .corona-canino,
        .diente-fdi.implante .corona-premolar,
        .diente-fdi.implante .corona-molar { 
            fill: #17a2b8;
            stroke: #0c5460;
            stroke-width: 2.5;
        }
        
        .diente-fdi.endodoncia .corona-incisivo,
        .diente-fdi.endodoncia .corona-canino,
        .diente-fdi.endodoncia .corona-premolar,
        .diente-fdi.endodoncia .corona-molar { 
            fill: #e83e8c;
            stroke: #a61e69;
        }
        
        /* Etiquetas de cuadrantes */
        .etiqueta-cuadrante {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 13px;
            font-weight: 600;
            fill: #495057;
            text-anchor: middle;
        }
        
        .etiqueta-sistema {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 16px;
            font-weight: 700;
            fill: #212529;
            text-anchor: middle;
        }
        
        .etiqueta-referencia {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 10px;
            font-weight: 500;
            fill: #6c757d;
            text-anchor: middle;
        }
        
        /* Áreas de cuadrantes con fondo sutil */
        .area-cuadrante {
            fill: rgba(0,0,0,0.02);
            stroke: none;
        }
        
        .area-cuadrante:hover {
            fill: rgba(0,123,255,0.05);
        }
    </style>
    
    <div class="text-center mb-3">
        <h4 style="color: #212529; margin-bottom: 8px; font-weight: 700;">
            🦷 Diagrama de la Dentición - Sistema de Numeración Universal (FDI)
        </h4>
        <p style="color: #6c757d; font-size: 0.9rem; margin-bottom: 5px;">
            Vista Oclusal con División por Cuadrantes
        </p>
        <p style="color: #868e96; font-size: 0.8rem;">
            Numeración de dos dígitos según estándar FDI/Universal para dentición permanente
        </p>
    </div>
    
    <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
        <!-- Fondo del diagrama -->
        <rect width="800" height="600" fill="#fafbfc" stroke="none"/>
        
        <!-- Título del sistema -->
        <text x="400" y="40" class="etiqueta-sistema">Sistema de Numeración Universal FDI</text>
        <text x="400" y="58" class="etiqueta-referencia">Dentición Permanente - Vista Oclusal</text>
        
        <!-- ==================== ÁREAS DE CUADRANTES ==================== -->
        
        <!-- Cuadrante Superior Derecho (11-18) -->
        <rect x="50" y="100" width="350" height="200" class="area-cuadrante" rx="5"/>
        
        <!-- Cuadrante Superior Izquierdo (21-28) -->
        <rect x="400" y="100" width="350" height="200" class="area-cuadrante" rx="5"/>
        
        <!-- Cuadrante Inferior Derecho (41-48) -->
        <rect x="50" y="300" width="350" height="200" class="area-cuadrante" rx="5"/>
        
        <!-- Cuadrante Inferior Izquierdo (31-38) -->
        <rect x="400" y="300" width="350" height="200" class="area-cuadrante" rx="5"/>
        
        <!-- ==================== LÍNEAS DE DIVISIÓN DE CUADRANTES ==================== -->
        
        <!-- Línea vertical central -->
        <line x1="400" y1="100" x2="400" y2="500" class="linea-cuadrante-principal"/>
        
        <!-- Línea horizontal central -->
        <line x1="50" y1="300" x2="750" y2="300" class="linea-cuadrante-principal"/>
        
        <!-- Líneas de referencia de cuadrantes -->
        <line x1="50" y1="100" x2="750" y2="100" class="linea-cuadrante"/>
        <line x1="50" y1="500" x2="750" y2="500" class="linea-cuadrante"/>
        <line x1="50" y1="100" x2="50" y2="500" class="linea-cuadrante"/>
        <line x1="750" y1="100" x2="750" y2="500" class="linea-cuadrante"/>
        
        <!-- ==================== ETIQUETAS DE CUADRANTES ==================== -->
        
        <text x="225" y="125" class="etiqueta-cuadrante">Cuadrante I (Superior Derecho)</text>
        <text x="225" y="140" class="etiqueta-referencia">Dientes 11-18</text>
        
        <text x="575" y="125" class="etiqueta-cuadrante">Cuadrante II (Superior Izquierdo)</text>
        <text x="575" y="140" class="etiqueta-referencia">Dientes 21-28</text>
        
        <text x="225" y="485" class="etiqueta-cuadrante">Cuadrante IV (Inferior Derecho)</text>
        <text x="225" y="470" class="etiqueta-referencia">Dientes 41-48</text>
        
        <text x="575" y="485" class="etiqueta-cuadrante">Cuadrante III (Inferior Izquierdo)</text>
        <text x="575" y="470" class="etiqueta-referencia">Dientes 31-38</text>
        
        <!-- ==================== CUADRANTE I - SUPERIOR DERECHO (11-18) ==================== -->
        
        <!-- Diente 18 - Tercer Molar Superior Derecho -->
        <g class="diente-fdi" id="diente-18">
            <rect x="70" y="160" width="30" height="30" rx="4" class="corona-molar"/>
            <text x="85" y="175" class="numero-fdi">18</text>
        </g>
        
        <!-- Diente 17 - Segundo Molar Superior Derecho -->
        <g class="diente-fdi" id="diente-17">
            <rect x="110" y="160" width="28" height="28" rx="4" class="corona-molar"/>
            <text x="124" y="174" class="numero-fdi">17</text>
        </g>
        
        <!-- Diente 16 - Primer Molar Superior Derecho -->
        <g class="diente-fdi" id="diente-16">
            <rect x="148" y="160" width="28" height="28" rx="4" class="corona-molar"/>
            <text x="162" y="174" class="numero-fdi">16</text>
        </g>
        
        <!-- Diente 15 - Segundo Premolar Superior Derecho -->
        <g class="diente-fdi" id="diente-15">
            <ellipse cx="198" cy="174" rx="12" ry="14" class="corona-premolar"/>
            <text x="198" y="174" class="numero-fdi">15</text>
        </g>
        
        <!-- Diente 14 - Primer Premolar Superior Derecho -->
        <g class="diente-fdi" id="diente-14">
            <ellipse cx="230" cy="174" rx="12" ry="14" class="corona-premolar"/>
            <text x="230" y="174" class="numero-fdi">14</text>
        </g>
        
        <!-- Diente 13 - Canino Superior Derecho -->
        <g class="diente-fdi" id="diente-13">
            <ellipse cx="262" cy="180" rx="10" ry="18" class="corona-canino"/>
            <text x="262" y="180" class="numero-fdi">13</text>
        </g>
        
        <!-- Diente 12 - Incisivo Lateral Superior Derecho -->
        <g class="diente-fdi" id="diente-12">
            <ellipse cx="290" cy="185" rx="8" ry="16" class="corona-incisivo"/>
            <text x="290" y="185" class="numero-fdi">12</text>
        </g>
        
        <!-- Diente 11 - Incisivo Central Superior Derecho -->
        <g class="diente-fdi" id="diente-11">
            <ellipse cx="315" cy="190" rx="9" ry="18" class="corona-incisivo"/>
            <text x="315" y="190" class="numero-fdi">11</text>
        </g>
        
        <!-- ==================== CUADRANTE II - SUPERIOR IZQUIERDO (21-28) ==================== -->
        
        <!-- Diente 21 - Incisivo Central Superior Izquierdo -->
        <g class="diente-fdi" id="diente-21">
            <ellipse cx="485" cy="190" rx="9" ry="18" class="corona-incisivo"/>
            <text x="485" y="190" class="numero-fdi">21</text>
        </g>
        
        <!-- Diente 22 - Incisivo Lateral Superior Izquierdo -->
        <g class="diente-fdi" id="diente-22">
            <ellipse cx="510" cy="185" rx="8" ry="16" class="corona-incisivo"/>
            <text x="510" y="185" class="numero-fdi">22</text>
        </g>
        
        <!-- Diente 23 - Canino Superior Izquierdo -->
        <g class="diente-fdi" id="diente-23">
            <ellipse cx="538" cy="180" rx="10" ry="18" class="corona-canino"/>
            <text x="538" y="180" class="numero-fdi">23</text>
        </g>
        
        <!-- Diente 24 - Primer Premolar Superior Izquierdo -->
        <g class="diente-fdi" id="diente-24">
            <ellipse cx="570" cy="174" rx="12" ry="14" class="corona-premolar"/>
            <text x="570" y="174" class="numero-fdi">24</text>
        </g>
        
        <!-- Diente 25 - Segundo Premolar Superior Izquierdo -->
        <g class="diente-fdi" id="diente-25">
            <ellipse cx="602" cy="174" rx="12" ry="14" class="corona-premolar"/>
            <text x="602" y="174" class="numero-fdi">25</text>
        </g>
        
        <!-- Diente 26 - Primer Molar Superior Izquierdo -->
        <g class="diente-fdi" id="diente-26">
            <rect x="622" y="160" width="28" height="28" rx="4" class="corona-molar"/>
            <text x="636" y="174" class="numero-fdi">26</text>
        </g>
        
        <!-- Diente 27 - Segundo Molar Superior Izquierdo -->
        <g class="diente-fdi" id="diente-27">
            <rect x="660" y="160" width="28" height="28" rx="4" class="corona-molar"/>
            <text x="674" y="174" class="numero-fdi">27</text>
        </g>
        
        <!-- Diente 28 - Tercer Molar Superior Izquierdo -->
        <g class="diente-fdi" id="diente-28">
            <rect x="700" y="160" width="30" height="30" rx="4" class="corona-molar"/>
            <text x="715" y="175" class="numero-fdi">28</text>
        </g>
        
        <!-- ==================== CUADRANTE IV - INFERIOR DERECHO (41-48) ==================== -->
        
        <!-- Diente 48 - Tercer Molar Inferior Derecho -->
        <g class="diente-fdi" id="diente-48">
            <rect x="70" y="410" width="30" height="30" rx="4" class="corona-molar"/>
            <text x="85" y="425" class="numero-fdi">48</text>
        </g>
        
        <!-- Diente 47 - Segundo Molar Inferior Derecho -->
        <g class="diente-fdi" id="diente-47">
            <rect x="110" y="410" width="28" height="28" rx="4" class="corona-molar"/>
            <text x="124" y="424" class="numero-fdi">47</text>
        </g>
        
        <!-- Diente 46 - Primer Molar Inferior Derecho -->
        <g class="diente-fdi" id="diente-46">
            <rect x="148" y="410" width="28" height="28" rx="4" class="corona-molar"/>
            <text x="162" y="424" class="numero-fdi">46</text>
        </g>
        
        <!-- Diente 45 - Segundo Premolar Inferior Derecho -->
        <g class="diente-fdi" id="diente-45">
            <ellipse cx="198" cy="424" rx="12" ry="14" class="corona-premolar"/>
            <text x="198" y="424" class="numero-fdi">45</text>
        </g>
        
        <!-- Diente 44 - Primer Premolar Inferior Derecho -->
        <g class="diente-fdi" id="diente-44">
            <ellipse cx="230" cy="424" rx="12" ry="14" class="corona-premolar"/>
            <text x="230" y="424" class="numero-fdi">44</text>
        </g>
        
        <!-- Diente 43 - Canino Inferior Derecho -->
        <g class="diente-fdi" id="diente-43">
            <ellipse cx="262" cy="418" rx="10" ry="18" class="corona-canino"/>
            <text x="262" y="418" class="numero-fdi">43</text>
        </g>
        
        <!-- Diente 42 - Incisivo Lateral Inferior Derecho -->
        <g class="diente-fdi" id="diente-42">
            <ellipse cx="290" cy="413" rx="8" ry="16" class="corona-incisivo"/>
            <text x="290" y="413" class="numero-fdi">42</text>
        </g>
        
        <!-- Diente 41 - Incisivo Central Inferior Derecho -->
        <g class="diente-fdi" id="diente-41">
            <ellipse cx="315" cy="408" rx="9" ry="18" class="corona-incisivo"/>
            <text x="315" y="408" class="numero-fdi">41</text>
        </g>
        
        <!-- ==================== CUADRANTE III - INFERIOR IZQUIERDO (31-38) ==================== -->
        
        <!-- Diente 31 - Incisivo Central Inferior Izquierdo -->
        <g class="diente-fdi" id="diente-31">
            <ellipse cx="485" cy="408" rx="9" ry="18" class="corona-incisivo"/>
            <text x="485" y="408" class="numero-fdi">31</text>
        </g>
        
        <!-- Diente 32 - Incisivo Lateral Inferior Izquierdo -->
        <g class="diente-fdi" id="diente-32">
            <ellipse cx="510" cy="413" rx="8" ry="16" class="corona-incisivo"/>
            <text x="510" y="413" class="numero-fdi">32</text>
        </g>
        
        <!-- Diente 33 - Canino Inferior Izquierdo -->
        <g class="diente-fdi" id="diente-33">
            <ellipse cx="538" cy="418" rx="10" ry="18" class="corona-canino"/>
            <text x="538" y="418" class="numero-fdi">33</text>
        </g>
        
        <!-- Diente 34 - Primer Premolar Inferior Izquierdo -->
        <g class="diente-fdi" id="diente-34">
            <ellipse cx="570" cy="424" rx="12" ry="14" class="corona-premolar"/>
            <text x="570" y="424" class="numero-fdi">34</text>
        </g>
        
        <!-- Diente 35 - Segundo Premolar Inferior Izquierdo -->
        <g class="diente-fdi" id="diente-35">
            <ellipse cx="602" cy="424" rx="12" ry="14" class="corona-premolar"/>
            <text x="602" y="424" class="numero-fdi">35</text>
        </g>
        
        <!-- Diente 36 - Primer Molar Inferior Izquierdo -->
        <g class="diente-fdi" id="diente-36">
            <rect x="622" y="410" width="28" height="28" rx="4" class="corona-molar"/>
            <text x="636" y="424" class="numero-fdi">36</text>
        </g>
        
        <!-- Diente 37 - Segundo Molar Inferior Izquierdo -->
        <g class="diente-fdi" id="diente-37">
            <rect x="660" y="410" width="28" height="28" rx="4" class="corona-molar"/>
            <text x="674" y="424" class="numero-fdi">37</text>
        </g>
        
        <!-- Diente 38 - Tercer Molar Inferior Izquierdo -->
        <g class="diente-fdi" id="diente-38">
            <rect x="700" y="410" width="30" height="30" rx="4" class="corona-molar"/>
            <text x="715" y="425" class="numero-fdi">38</text>
        </g>
        
        <!-- ==================== REFERENCIAS Y LEYENDAS ==================== -->
        
        <!-- Leyenda del sistema -->
        <rect x="50" y="520" width="700" height="60" fill="#f8f9fa" stroke="#dee2e6" rx="8"/>
        
        <text x="400" y="540" class="etiqueta-cuadrante">Sistema de Numeración FDI (Fédération Dentaire Internationale)</text>
        <text x="400" y="555" class="etiqueta-referencia">Primer dígito: Cuadrante (1=Sup.Der, 2=Sup.Izq, 3=Inf.Izq, 4=Inf.Der)</text>
        <text x="400" y="568" class="etiqueta-referencia">Segundo dígito: Posición dental (1-8, desde central hacia molar)</text>
        
    </svg>
</div>

<script>
(function() {
    'use strict';
    
    function log(mensaje) {
        console.log(`[ODONTOGRAMA FDI UNIVERSAL] ${mensaje}`);
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        log('Iniciando sistema de numeración FDI Universal');
        
        const dientes = document.querySelectorAll('.diente-fdi');
        log(`Configurando ${dientes.length} dientes con numeración FDI`);
        
        // Mapa de cuadrantes FDI
        const cuadrantes = {
            1: { nombre: 'Superior Derecho', rango: '11-18' },
            2: { nombre: 'Superior Izquierdo', rango: '21-28' },
            3: { nombre: 'Inferior Izquierdo', rango: '31-38' },
            4: { nombre: 'Inferior Derecho', rango: '41-48' }
        };
        
        dientes.forEach(function(diente, index) {
            const dienteId = diente.id;
            const numeroFDI = dienteId.replace('diente-', '');
            const cuadrante = Math.floor(numeroFDI / 10);
            const posicion = numeroFDI % 10;
            
            diente.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                log(`Diente seleccionado: ${numeroFDI} (Cuadrante ${cuadrante}: ${cuadrantes[cuadrante].nombre}, Posición ${posicion})`);
                
                // Remover selección anterior
                document.querySelectorAll('.diente-fdi').forEach(d => {
                    d.classList.remove('selected');
                });
                
                // Seleccionar diente actual
                diente.classList.add('selected');
                
                // Identificar tipo de diente
                let tipoDiente = '';
                if (posicion === 1 || posicion === 2) {
                    tipoDiente = 'Incisivo';
                } else if (posicion === 3) {
                    tipoDiente = 'Canino';
                } else if (posicion === 4 || posicion === 5) {
                    tipoDiente = 'Premolar';
                } else if (posicion === 6 || posicion === 7 || posicion === 8) {
                    tipoDiente = 'Molar';
                }
                
                log(`Información: ${tipoDiente} ${numeroFDI} - Cuadrante ${cuadrante} (${cuadrantes[cuadrante].nombre})`);
                
                // Disparar evento personalizado
                const eventoSeleccion = new CustomEvent('dienteFDISeleccionado', {
                    detail: {
                        numeroFDI: numeroFDI,
                        cuadrante: cuadrante,
                        posicion: posicion,
                        tipoDiente: tipoDiente,
                        nombreCuadrante: cuadrantes[cuadrante].nombre,
                        elemento: diente
                    }
                });
                
                document.dispatchEvent(eventoSeleccion);
            });
            
            diente.addEventListener('mouseenter', function() {
                log(`Hover en diente FDI ${numeroFDI}`);
            });
        });
        
        log('Sistema FDI Universal inicializado correctamente');
        log('Cuadrantes configurados:', cuadrantes);
    });
    
    // Función global para aplicar diagnósticos
    window.aplicarDiagnosticoFDI = function(numeroFDI, diagnostico) {
        const diente = document.getElementById(`diente-${numeroFDI}`);
        if (diente) {
            // Remover diagnósticos anteriores
            diente.classList.remove('sano', 'caries', 'obturada', 'corona', 'extraida', 'implante', 'endodoncia');
            
            // Aplicar nuevo diagnóstico
            if (diagnostico) {
                diente.classList.add(diagnostico);
                log(`Diagnóstico aplicado: Diente ${numeroFDI} - ${diagnostico}`);
            }
        }
    };
    
    // Función global para limpiar selecciones
    window.limpiarSeleccionFDI = function() {
        document.querySelectorAll('.diente-fdi').forEach(diente => {
            diente.classList.remove('selected', 'sano', 'caries', 'obturada', 'corona', 'extraida', 'implante', 'endodoncia');
        });
        log('Selección y diagnósticos limpiados');
    };
    
})();
</script>