{% load math_filters %}
<!-- Odontograma M√≥vil Optimizado - Vista Oclusal Anat√≥mica -->
<div id="odontograma-movil" class="container-fluid">
    <style>
        /* Estilos base para el contenedor m√≥vil */
        #odontograma-movil {
            max-width: 100%;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* SVG responsivo */
        .odontograma-svg {
            width: 100%;
            height: auto;
            max-width: 900px;
            margin: 0 auto;
            display: block;
            background: #ffffff;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }

        /* Estilos para los dientes */
        .diente-svg {
            cursor: pointer;
        }

        .diente-svg:hover {
            /* Sin animaciones en hover */
        }

        .diente-svg.selected .superficie-dental {
            stroke: #007bff !important;
            stroke-width: 4 !important;
            stroke-dasharray: none !important;
        }

        .superficie-dental {
            fill: #ffffff;
            stroke: #2c3e50;
            stroke-width: 2;
            transition: all 0.3s ease;
        }

        .numero-diente {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px;
            font-weight: bold;
            fill: #2c3e50;
            text-anchor: middle;
            pointer-events: none;
            user-select: none;
        }

        /* Estados cl√≠nicos con colores evidentes */
        .diente-svg.sano .superficie-dental { 
            fill: #27ae60 !important; 
            stroke: #1e8449 !important; 
            stroke-width: 3 !important;
        }
        
        .diente-svg.caries .superficie-dental { 
            fill: #e74c3c !important; 
            stroke: #c0392b !important; 
            stroke-width: 3 !important;
        }
        
        .diente-svg.obturada .superficie-dental { 
            fill: #f39c12 !important; 
            stroke: #d68910 !important; 
            stroke-width: 3 !important;
        }
        
        .diente-svg.corona .superficie-dental { 
            fill: #3498db !important; 
            stroke: #2980b9 !important; 
            stroke-width: 3 !important;
        }
        
        .diente-svg.extraida .superficie-dental { 
            fill: #95a5a6 !important; 
            stroke: #7f8c8d !important; 
            stroke-dasharray: 8,4 !important;
            stroke-width: 3 !important;
            opacity: 0.7;
        }

        .diente-svg.implante .superficie-dental { 
            fill: #8e44ad !important; 
            stroke: #6c3483 !important; 
            stroke-width: 4 !important;
        }

        .diente-svg.endodoncia .superficie-dental { 
            fill: #e91e63 !important; 
            stroke: #ad1457 !important; 
            stroke-width: 3 !important;
        }

        /* T√≠tulos y etiquetas */
        .titulo-principal {
            text-align: center;
            color: #2c3e50;
            font-weight: bold;
            margin: 10px 0;
            font-size: 20px;
        }

        .subtitulo {
            text-align: center;
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 15px;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .titulo-principal { font-size: 18px; }
            .subtitulo { font-size: 12px; }
            .numero-diente { font-size: 10px; }
        }

        /* Sin animaciones t√°ctiles */
        .diente-selected {
            /* Sin animaciones */
        }
    </style>
    
    <!-- T√≠tulo del odontograma -->
    <div class="titulo-principal">ü¶∑ Odontograma Cl√≠nico M√≥vil Optimizado</div>
    <div class="subtitulo">Vista Oclusal Anat√≥mica - Sistema FDI (32 Dientes)</div>
    <div class="subtitulo">Dise√±o responsivo para dispositivos m√≥viles</div>
    
    <!-- SVG del odontograma con vista oclusal anat√≥mica -->
    <svg viewBox="0 0 900 480" xmlns="http://www.w3.org/2000/svg" class="odontograma-svg">
        
        <!-- Fondo y estructura base -->
        <defs>
            <radialGradient id="encia-grad" cx="50%" cy="50%" r="50%">
                <stop offset="0%" style="stop-color:#ffeaa7"/>
                <stop offset="100%" style="stop-color:#dda15e"/>
            </radialGradient>
        </defs>
        
        <!-- Forma de las enc√≠as/maxilares (posici√≥n original) -->
        <ellipse cx="450" cy="135" rx="400" ry="85" fill="url(#encia-grad)" opacity="0.6"/>
        <ellipse cx="450" cy="285" rx="400" ry="85" fill="url(#encia-grad)" opacity="0.6"/>
        
        <!-- L√≠nea divisoria central -->
        <line x1="450" y1="50" x2="450" y2="190" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="5,3"/>
        <line x1="450" y1="250" x2="450" y2="430" stroke="#bdc3c7" stroke-width="2" stroke-dasharray="5,3"/>
        
        <!-- Etiquetas de orientaci√≥n -->
        <text x="450" y="35" font-size="16" font-weight="bold" fill="#2c3e50" text-anchor="middle">Superior</text>
        <text x="450" y="465" font-size="16" font-weight="bold" fill="#2c3e50" text-anchor="middle">Inferior</text>
        <text x="50" y="220" font-size="12" fill="#7f8c8d" text-anchor="middle">Derecha Paciente</text>
        <text x="850" y="220" font-size="12" fill="#7f8c8d" text-anchor="middle">Izquierda Paciente</text>
        
        <!-- Separaci√≥n entre cuadrantes superior e inferior -->
        <rect x="0" y="190" width="900" height="60" fill="#f8f9fa" opacity="0.3"/>
        <text x="450" y="220" font-size="12" fill="#6c757d" text-anchor="middle">SEPARACI√ìN ENTRE ARCADAS</text>

        <!-- ============ CUADRANTE SUPERIOR DERECHO (18-11) ============ -->
        
        <!-- 18 - Tercer Molar Superior Derecho -->
        <g class="diente-svg molar" id="diente-1">
            <path d="M 90 175 Q 100 165 115 170 Q 125 165 130 175 Q 130 190 120 195 Q 105 200 95 195 Q 85 185 90 175 Z" class="superficie-dental"/>
            <text x="112" y="215" class="numero-diente">18</text>
        </g>
        
        <!-- 17 - Segundo Molar Superior Derecho -->
        <g class="diente-svg molar" id="diente-2">
            <path d="M 150 155 Q 160 145 175 150 Q 185 145 190 155 Q 190 170 180 175 Q 165 180 155 175 Q 145 165 150 155 Z" class="superficie-dental"/>
            <text x="167" y="195" class="numero-diente">17</text>
        </g>
        
        <!-- 16 - Primer Molar Superior Derecho -->
        <g class="diente-svg molar" id="diente-3">
            <path d="M 210 135 Q 220 125 235 130 Q 245 125 250 135 Q 250 150 240 155 Q 225 160 215 155 Q 205 145 210 135 Z" class="superficie-dental"/>
            <text x="227" y="175" class="numero-diente">16</text>
        </g>
        
        <!-- 15 - Segundo Premolar Superior Derecho -->
        <g class="diente-svg premolar" id="diente-4">
            <path d="M 270 115 Q 278 105 290 110 Q 298 105 302 115 Q 302 127 294 132 Q 284 135 276 132 Q 268 125 270 115 Z" class="superficie-dental"/>
            <text x="286" y="155" class="numero-diente">15</text>
        </g>
        
        <!-- 14 - Primer Premolar Superior Derecho -->
        <g class="diente-svg premolar" id="diente-5">
            <path d="M 315 100 Q 323 90 335 95 Q 343 90 347 100 Q 347 112 339 117 Q 329 120 321 117 Q 313 110 315 100 Z" class="superficie-dental"/>
            <text x="331" y="140" class="numero-diente">14</text>
        </g>
        
        <!-- 13 - Canino Superior Derecho -->
        <g class="diente-svg canino" id="diente-6">
            <path d="M 355 90 Q 365 70 380 90 Q 378 110 365 115 Q 357 110 355 90 Z" class="superficie-dental"/>
            <text x="367" y="135" class="numero-diente">13</text>
        </g>
        
        <!-- 12 - Incisivo Lateral Superior Derecho -->
        <g class="diente-svg incisivo" id="diente-7">
            <path d="M 385 85 Q 390 75 400 80 Q 405 75 410 85 Q 410 103 405 108 Q 395 110 390 108 Q 385 100 385 85 Z" class="superficie-dental"/>
            <text x="397" y="130" class="numero-diente">12</text>
        </g>
        
        <!-- 11 - Incisivo Central Superior Derecho -->
        <g class="diente-svg incisivo" id="diente-8">
            <path d="M 415 83 Q 420 73 430 78 Q 440 73 445 83 Q 445 103 440 108 Q 430 110 420 108 Q 415 100 415 83 Z" class="superficie-dental"/>
            <text x="430" y="130" class="numero-diente">11</text>
        </g>
        
        <!-- ============ CUADRANTE SUPERIOR IZQUIERDO (21-28) ============ -->
        
        <!-- 21 - Incisivo Central Superior Izquierdo -->
        <g class="diente-svg incisivo" id="diente-9">
            <path d="M 455 83 Q 460 73 470 78 Q 480 73 485 83 Q 485 103 480 108 Q 470 110 460 108 Q 455 100 455 83 Z" class="superficie-dental"/>
            <text x="470" y="130" class="numero-diente">21</text>
        </g>
        
        <!-- 22 - Incisivo Lateral Superior Izquierdo -->
        <g class="diente-svg incisivo" id="diente-10">
            <path d="M 490 85 Q 495 75 505 80 Q 510 75 515 85 Q 515 103 510 108 Q 500 110 495 108 Q 490 100 490 85 Z" class="superficie-dental"/>
            <text x="502" y="130" class="numero-diente">22</text>
        </g>
        
        <!-- 23 - Canino Superior Izquierdo -->
        <g class="diente-svg canino" id="diente-11">
            <path d="M 520 90 Q 530 70 545 90 Q 543 110 530 115 Q 522 110 520 90 Z" class="superficie-dental"/>
            <text x="532" y="135" class="numero-diente">23</text>
        </g>
        
        <!-- 24 - Primer Premolar Superior Izquierdo -->
        <g class="diente-svg premolar" id="diente-12">
            <path d="M 553 100 Q 561 90 573 95 Q 581 90 585 100 Q 585 112 577 117 Q 567 120 559 117 Q 551 110 553 100 Z" class="superficie-dental"/>
            <text x="569" y="140" class="numero-diente">24</text>
        </g>
        
        <!-- 25 - Segundo Premolar Superior Izquierdo -->
        <g class="diente-svg premolar" id="diente-13">
            <path d="M 598 115 Q 606 105 618 110 Q 626 105 630 115 Q 630 127 622 132 Q 612 135 604 132 Q 596 125 598 115 Z" class="superficie-dental"/>
            <text x="614" y="155" class="numero-diente">25</text>
        </g>
        
        <!-- 26 - Primer Molar Superior Izquierdo -->
        <g class="diente-svg molar" id="diente-14">
            <path d="M 640 135 Q 650 125 665 130 Q 675 125 680 135 Q 680 150 670 155 Q 655 160 645 155 Q 635 145 640 135 Z" class="superficie-dental"/>
            <text x="657" y="175" class="numero-diente">26</text>
        </g>
        
        <!-- 27 - Segundo Molar Superior Izquierdo -->
        <g class="diente-svg molar" id="diente-15">
            <path d="M 700 155 Q 710 145 725 150 Q 735 145 740 155 Q 740 170 730 175 Q 715 180 705 175 Q 695 165 700 155 Z" class="superficie-dental"/>
            <text x="717" y="195" class="numero-diente">27</text>
        </g>
        
        <!-- 28 - Tercer Molar Superior Izquierdo -->
        <g class="diente-svg molar" id="diente-16">
            <path d="M 760 175 Q 770 165 785 170 Q 795 165 800 175 Q 800 190 790 195 Q 775 200 765 195 Q 755 185 760 175 Z" class="superficie-dental"/>
            <text x="777" y="215" class="numero-diente">28</text>
        </g>

        <!-- ============ CUADRANTE INFERIOR IZQUIERDO (31-38) ============ -->
        
        <!-- 31 - Incisivo Central Inferior Izquierdo -->
        <g class="diente-svg incisivo" id="diente-17">
            <path d="M 455 357 Q 460 367 470 362 Q 480 367 485 357 Q 485 337 480 332 Q 470 330 460 332 Q 455 340 455 357 Z" class="superficie-dental"/>
            <text x="470" y="380" class="numero-diente">31</text>
        </g>
        
        <!-- 32 - Incisivo Lateral Inferior Izquierdo -->
        <g class="diente-svg incisivo" id="diente-18">
            <path d="M 490 355 Q 495 365 505 360 Q 510 365 515 355 Q 515 337 510 332 Q 500 330 495 332 Q 490 340 490 355 Z" class="superficie-dental"/>
            <text x="502" y="380" class="numero-diente">32</text>
        </g>
        
        <!-- 33 - Canino Inferior Izquierdo -->
        <g class="diente-svg canino" id="diente-19">
            <path d="M 520 350 Q 530 370 545 350 Q 543 330 530 325 Q 522 330 520 350 Z" class="superficie-dental"/>
            <text x="532" y="385" class="numero-diente">33</text>
        </g>
        
        <!-- 34 - Primer Premolar Inferior Izquierdo -->
        <g class="diente-svg premolar" id="diente-20">
            <path d="M 553 340 Q 561 350 573 345 Q 581 350 585 340 Q 585 328 577 323 Q 567 320 559 323 Q 551 330 553 340 Z" class="superficie-dental"/>
            <text x="569" y="365" class="numero-diente">34</text>
        </g>
        
        <!-- 35 - Segundo Premolar Inferior Izquierdo -->
        <g class="diente-svg premolar" id="diente-21">
            <path d="M 598 325 Q 606 335 618 330 Q 626 335 630 325 Q 630 313 622 308 Q 612 305 604 308 Q 596 315 598 325 Z" class="superficie-dental"/>
            <text x="614" y="350" class="numero-diente">35</text>
        </g>
        
        <!-- 36 - Primer Molar Inferior Izquierdo -->
        <g class="diente-svg molar" id="diente-22">
            <path d="M 640 305 Q 650 315 665 310 Q 675 315 680 305 Q 680 290 670 285 Q 655 280 645 285 Q 635 295 640 305 Z" class="superficie-dental"/>
            <text x="657" y="330" class="numero-diente">36</text>
        </g>
        
        <!-- 37 - Segundo Molar Inferior Izquierdo -->
        <g class="diente-svg molar" id="diente-23">
            <path d="M 700 285 Q 710 295 725 290 Q 735 295 740 285 Q 740 270 730 265 Q 715 260 705 265 Q 695 275 700 285 Z" class="superficie-dental"/>
            <text x="717" y="310" class="numero-diente">37</text>
        </g>
        
        <!-- 38 - Tercer Molar Inferior Izquierdo -->
        <g class="diente-svg molar" id="diente-24">
            <path d="M 760 265 Q 770 275 785 270 Q 795 275 800 265 Q 800 250 790 245 Q 775 240 765 245 Q 755 255 760 265 Z" class="superficie-dental"/>
            <text x="777" y="290" class="numero-diente">38</text>
        </g>

        <!-- ============ CUADRANTE INFERIOR DERECHO (41-48) ============ -->
        
        <!-- 41 - Incisivo Central Inferior Derecho -->
        <g class="diente-svg incisivo" id="diente-25">
            <path d="M 415 357 Q 420 367 430 362 Q 440 367 445 357 Q 445 337 440 332 Q 430 330 420 332 Q 415 340 415 357 Z" class="superficie-dental"/>
            <text x="430" y="380" class="numero-diente">41</text>
        </g>
        
        <!-- 42 - Incisivo Lateral Inferior Derecho -->
        <g class="diente-svg incisivo" id="diente-26">
            <path d="M 385 355 Q 390 365 400 360 Q 405 365 410 355 Q 410 337 405 332 Q 395 330 390 332 Q 385 340 385 355 Z" class="superficie-dental"/>
            <text x="397" y="380" class="numero-diente">42</text>
        </g>
        
        <!-- 43 - Canino Inferior Derecho -->
        <g class="diente-svg canino" id="diente-27">
            <path d="M 355 350 Q 365 370 380 350 Q 378 330 365 325 Q 357 330 355 350 Z" class="superficie-dental"/>
            <text x="367" y="385" class="numero-diente">43</text>
        </g>
        
        <!-- 44 - Primer Premolar Inferior Derecho -->
        <g class="diente-svg premolar" id="diente-28">
            <path d="M 315 340 Q 323 350 335 345 Q 343 350 347 340 Q 347 328 339 323 Q 329 320 321 323 Q 313 330 315 340 Z" class="superficie-dental"/>
            <text x="331" y="365" class="numero-diente">44</text>
        </g>
        
        <!-- 45 - Segundo Premolar Inferior Derecho -->
        <g class="diente-svg premolar" id="diente-29">
            <path d="M 270 325 Q 278 335 290 330 Q 298 335 302 325 Q 302 313 294 308 Q 284 305 276 308 Q 268 315 270 325 Z" class="superficie-dental"/>
            <text x="286" y="350" class="numero-diente">45</text>
        </g>
        
        <!-- 46 - Primer Molar Inferior Derecho -->
        <g class="diente-svg molar" id="diente-30">
            <path d="M 210 305 Q 220 315 235 310 Q 245 315 250 305 Q 250 290 240 285 Q 225 280 215 285 Q 205 295 210 305 Z" class="superficie-dental"/>
            <text x="227" y="330" class="numero-diente">46</text>
        </g>
        
        <!-- 47 - Segundo Molar Inferior Derecho -->
        <g class="diente-svg molar" id="diente-31">
            <path d="M 150 285 Q 160 295 175 290 Q 185 295 190 285 Q 190 270 180 265 Q 165 260 155 265 Q 145 275 150 285 Z" class="superficie-dental"/>
            <text x="167" y="310" class="numero-diente">47</text>
        </g>
        
        <!-- 48 - Tercer Molar Inferior Derecho -->
        <g class="diente-svg molar" id="diente-32">
            <path d="M 90 265 Q 100 275 115 270 Q 125 275 130 265 Q 130 250 120 245 Q 105 240 95 245 Q 85 255 90 265 Z" class="superficie-dental"/>
            <text x="112" y="290" class="numero-diente">48</text>
        </g>
        
        <!-- L√≠nea divisoria entre arcadas (ya integrada arriba) -->
        
    </svg>
</div>

<!-- JavaScript para funcionalidad del odontograma m√≥vil -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('[ODONTOGRAMA M√ìVIL] Inicializando...');
        
        const odontograma = document.getElementById('odontograma-movil');
        const dientes = odontograma.querySelectorAll('.diente-svg');
        
        console.log(`[ODONTOGRAMA M√ìVIL] ${dientes.length} dientes configurados`);
        
        // Configurar eventos para cada diente
        dientes.forEach(function(diente, index) {
            // Evento t√°ctil para m√≥viles
            diente.addEventListener('touchstart', function(e) {
                e.preventDefault();
                this.classList.add('diente-selected');
            });
            
            diente.addEventListener('touchend', function(e) {
                e.preventDefault();
                this.classList.remove('diente-selected');
                
                // Convertir a click para mantener compatibilidad
                const clickEvent = new Event('click', { bubbles: true });
                this.dispatchEvent(clickEvent);
            });
            
            // Evento click est√°ndar
            diente.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                console.log(`[ODONTOGRAMA M√ìVIL] Click en ${this.id}`);
                
                // Quitar selecci√≥n anterior
                dientes.forEach(d => d.classList.remove('selected'));
                
                // Seleccionar diente actual
                this.classList.add('selected');
                
                const numero = this.id.replace('diente-', '');
                
                // Emitir evento personalizado para compatibilidad
                const evento = new CustomEvent('dienteSeleccionado', {
                    detail: { 
                        numero: numero,
                        elemento: this,
                        tipo: 'movil-optimizado'
                    },
                    bubbles: true
                });
                
                document.dispatchEvent(evento);
                console.log(`[ODONTOGRAMA M√ìVIL] Diente ${numero} seleccionado`);
            });
        });
        
        // Mantener compatibilidad con sistema existente
        if (typeof window.initOdontograma === 'function') {
            console.log('[ODONTOGRAMA M√ìVIL] Ejecutando inicializaci√≥n del sistema existente...');
            window.initOdontograma();
        }
        
        console.log('[ODONTOGRAMA M√ìVIL] ‚úÖ Inicializaci√≥n completa');
    });
</script>

<script>
(function() {
    'use strict';
    
    function log(mensaje) {
        console.log(`[ODONTOGRAMA SVG] ${mensaje}`);
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        log('Iniciando odontograma SVG limpio');
        
        const dientes = document.querySelectorAll('.diente-svg');
        log(`Configurando ${dientes.length} dientes`);
        
        dientes.forEach(function(diente, index) {
            diente.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                log(`Clic en ${diente.id}`);
                
                // Quitar selecci√≥n anterior
                document.querySelectorAll('.diente-svg').forEach(d => {
                    d.classList.remove('selected');
                });
                
                // Seleccionar este diente
                diente.classList.add('selected');
                
                const numero = diente.id.replace('diente-', '');
                log(`Diente ${numero} seleccionado`);
                
                // Emitir evento
                const evento = new CustomEvent('dienteSeleccionado', {
                    detail: { 
                        numero: numero, 
                        elemento: diente,
                        tipo: 'svg-limpio'
                    },
                    bubbles: true
                });
                
                document.dispatchEvent(evento);
                
                // Feedback visual temporal
                const forma = diente.querySelector('.diente-forma');
                if (forma) {
                    const colorOriginal = forma.getAttribute('fill');
                    forma.setAttribute('fill', '#ffeb3b');
                    setTimeout(() => {
                        if (!diente.classList.contains('sano') && !diente.classList.contains('caries')) {
                            forma.setAttribute('fill', colorOriginal || '');
                        }
                    }, 800);
                }
            });
            
            // Confirmar configuraci√≥n
            if (index < 5) { // Solo log para los primeros 5
                log(`‚úì Configurado ${diente.id}`);
            }
        });
        
        log('‚úÖ Odontograma SVG limpio listo');
    });
})();
</script>