{% load math_filters %}
<div id="odontograma-arcos" class="odontograma-arcos">
    <style>
        .odontograma-arcos {
            max-width: 1000px;
            margin: 0 auto;
            padding: 15px;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        .odontograma-arcos svg {
            width: 100%;
            height: auto;
            background: linear-gradient(135deg, #f8fdff 0%, #e8f4fd 100%);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 123, 255, 0.15);
            border: 2px solid #e3f2fd;
        }
        
        /* Dientes contiguos sin espacios */
        .diente-arco {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .diente-arco:hover {
            filter: drop-shadow(0 0 8px rgba(33, 150, 243, 0.6));
        }
        
        .diente-arco.selected {
            filter: drop-shadow(0 0 12px rgba(255, 193, 7, 1));
        }
        
        /* Formas de dientes contiguos */
        .diente-forma {
            fill: #ffffff;
            stroke: #37474f;
            stroke-width: 1.5;
            transition: all 0.2s ease;
        }
        
        .diente-numero {
            font-family: 'Arial', sans-serif;
            font-size: 9px;
            font-weight: bold;
            fill: #263238;
            text-anchor: middle;
            pointer-events: none;
            dominant-baseline: central;
        }
        
        /* Estados de diagnÃ³stico */
        .diente-arco.sano .diente-forma { 
            fill: #4caf50;
            stroke: #2e7d32;
        }
        .diente-arco.caries .diente-forma { 
            fill: #f44336;
            stroke: #c62828;
        }
        .diente-arco.obturada .diente-forma { 
            fill: #ff9800;
            stroke: #ef6c00;
        }
        .diente-arco.corona .diente-forma { 
            fill: #2196f3;
            stroke: #1565c0;
        }
        .diente-arco.extraida .diente-forma { 
            fill: #9e9e9e;
            stroke: #424242;
            stroke-dasharray: 5,3;
            opacity: 0.7;
        }
        .diente-arco.implante .diente-forma { 
            fill: #00bcd4;
            stroke: #006064;
            stroke-width: 2.5;
        }
        .diente-arco.endodoncia .diente-forma { 
            fill: #e91e63;
            stroke: #ad1457;
        }
        
        /* Supernumerarios en paneles */
        .supernumerario .diente-forma {
            stroke: #ff5722;
            stroke-dasharray: 3,2;
            opacity: 0.8;
        }
        
        .supernumerario .diente-numero {
            fill: #ff5722;
            font-size: 7px;
        }
        
        .etiqueta-arco {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 13px;
            font-weight: 600;
            fill: #455a64;
            text-anchor: middle;
        }
        
        .panel-extra {
            fill: #f5f5f5;
            stroke: #ddd;
            stroke-width: 1;
            opacity: 0.7;
        }
    </style>
    
    <div class="text-center mb-3">
        <h4 style="color: #37474f; margin-bottom: 10px; font-weight: 600;">
            ðŸ¦· Odontograma - Arcos Dentales Contiguos
        </h4>
        <p style="color: #78909c; font-size: 0.9rem;">Dientes unidos como en una sonrisa real</p>
    </div>
    
    <svg viewBox="0 0 1100 600" xmlns="http://www.w3.org/2000/svg">
        <!-- Fondo sutil -->
        <rect width="1100" height="600" fill="#fafbfc" opacity="0.5"/>
        
        <!-- Etiquetas -->
        <text x="550" y="50" class="etiqueta-arco">ARCADA SUPERIOR</text>
        <text x="550" y="580" class="etiqueta-arco">ARCADA INFERIOR</text>
        
        <!-- LÃ­nea central de referencia -->
        <line x1="550" y1="70" x2="550" y2="520" stroke="#e0e0e0" stroke-width="1" stroke-dasharray="3,3" opacity="0.5"/>
        
        <!-- Contorno de la boca -->
        <ellipse cx="550" cy="300" rx="450" ry="180" fill="none" stroke="#90a4ae" stroke-width="2" opacity="0.5"/>
        
        <!-- Lengua (fondo) -->
        <ellipse cx="550" cy="320" rx="200" ry="60" fill="#ffab91" stroke="#ff8a65" stroke-width="1" opacity="0.2"/>
        
        <!-- EncÃ­as superiores -->
        <ellipse cx="550" cy="180" rx="350" ry="25" fill="#ffcdd2" stroke="#f8bbd9" stroke-width="1" opacity="0.4"/>
        
        <!-- EncÃ­as inferiores -->
        <ellipse cx="550" cy="420" rx="350" ry="25" fill="#ffcdd2" stroke="#f8bbd9" stroke-width="1" opacity="0.4"/>
        
        <!-- ========================= ARCADA SUPERIOR HORIZONTAL ========================= -->
        <!-- Arco superior horizontal como sonrisa real (1-16) -->
        <!-- Centro: 550, 300 - Arco superior curvado hacia arriba -->
        
        <!-- Diente 1 (Molar 3 superior derecho) - extremo derecho -->
        <g class="diente-arco" id="diente-1" transform="rotate(135 550 200)">
            <path d="M 380 180 Q 405 170 430 180 Q 435 200 430 220 Q 405 230 380 220 Q 375 200 380 180 Z" class="diente-forma"/>
            <text x="405" y="200" class="diente-numero">1</text>
        </g>
        
        <!-- Diente 2 (Molar 2 superior derecho) -->
        <g class="diente-arco" id="diente-2" transform="rotate(120 550 200)">
            <path d="M 380 180 Q 405 170 430 180 Q 435 200 430 220 Q 405 230 380 220 Q 375 200 380 180 Z" class="diente-forma"/>
            <text x="405" y="200" class="diente-numero">2</text>
        </g>
        
        <!-- Diente 3 (Molar 1 superior derecho) -->
        <g class="diente-arco" id="diente-3" transform="rotate(105 550 200)">
            <path d="M 380 180 Q 405 170 430 180 Q 435 200 430 220 Q 405 230 380 220 Q 375 200 380 180 Z" class="diente-forma"/>
            <text x="405" y="200" class="diente-numero">3</text>
        </g>
        
        <!-- Diente 4 (Premolar 2 superior derecho) -->
        <g class="diente-arco" id="diente-4" transform="rotate(90 550 200)">
            <path d="M 385 185 Q 405 175 425 185 Q 430 200 425 215 Q 405 225 385 215 Q 380 200 385 185 Z" class="diente-forma"/>
            <text x="405" y="200" class="diente-numero">4</text>
        </g>
        
        <!-- Diente 5 (Premolar 1 superior derecho) -->
        <g class="diente-arco" id="diente-5" transform="rotate(75 550 200)">
            <path d="M 385 185 Q 405 175 425 185 Q 430 200 425 215 Q 405 225 385 215 Q 380 200 385 185 Z" class="diente-forma"/>
            <text x="405" y="200" class="diente-numero">5</text>
        </g>
        
        <!-- Diente 6 (Canino superior derecho) -->
        <g class="diente-arco" id="diente-6" transform="rotate(60 550 200)">
            <path d="M 380 180 Q 405 168 430 180 Q 435 205 430 230 Q 405 242 380 230 Q 375 205 380 180 Z" class="diente-forma"/>
            <text x="405" y="205" class="diente-numero">6</text>
        </g>
        
        <!-- Diente 7 (Incisivo lateral superior derecho) -->
        <g class="diente-arco" id="diente-7" transform="rotate(40 550 200)">
            <path d="M 382 188 Q 400 178 418 188 Q 423 200 418 212 Q 400 222 382 212 Q 377 200 382 188 Z" class="diente-forma"/>
            <text x="400" y="200" class="diente-numero">7</text>
        </g>
        
        <!-- Diente 8 (Incisivo central superior derecho) -->
        <g class="diente-arco" id="diente-8" transform="rotate(20 550 200)">
            <path d="M 380 185 Q 402 173 424 185 Q 429 202 424 219 Q 402 231 380 219 Q 375 202 380 185 Z" class="diente-forma"/>
            <text x="402" y="202" class="diente-numero">8</text>
        </g>
        
        <!-- Diente 9 (Incisivo central superior izquierdo) -->
        <g class="diente-arco" id="diente-9" transform="rotate(-20 550 200)">
            <path d="M 380 185 Q 402 173 424 185 Q 429 202 424 219 Q 402 231 380 219 Q 375 202 380 185 Z" class="diente-forma"/>
            <text x="402" y="202" class="diente-numero">9</text>
        </g>
        
        <!-- Diente 10 (Incisivo lateral superior izquierdo) -->
        <g class="diente-arco" id="diente-10" transform="rotate(-40 550 200)">
            <path d="M 382 188 Q 400 178 418 188 Q 423 200 418 212 Q 400 222 382 212 Q 377 200 382 188 Z" class="diente-forma"/>
            <text x="400" y="200" class="diente-numero">10</text>
        </g>
        
        <!-- Diente 11 (Canino superior izquierdo) -->
        <g class="diente-arco" id="diente-11" transform="rotate(-60 550 200)">
            <path d="M 380 180 Q 405 168 430 180 Q 435 205 430 230 Q 405 242 380 230 Q 375 205 380 180 Z" class="diente-forma"/>
            <text x="405" y="205" class="diente-numero">11</text>
        </g>
        
        <!-- Diente 12 (Premolar 1 superior izquierdo) -->
        <g class="diente-arco" id="diente-12" transform="rotate(-75 550 200)">
            <path d="M 385 185 Q 405 175 425 185 Q 430 200 425 215 Q 405 225 385 215 Q 380 200 385 185 Z" class="diente-forma"/>
            <text x="405" y="200" class="diente-numero">12</text>
        </g>
        
        <!-- Diente 13 (Premolar 2 superior izquierdo) -->
        <g class="diente-arco" id="diente-13" transform="rotate(-90 550 200)">
            <path d="M 385 185 Q 405 175 425 185 Q 430 200 425 215 Q 405 225 385 215 Q 380 200 385 185 Z" class="diente-forma"/>
            <text x="405" y="200" class="diente-numero">13</text>
        </g>
        
        <!-- Diente 14 (Molar 1 superior izquierdo) -->
        <g class="diente-arco" id="diente-14" transform="rotate(-105 550 200)">
            <path d="M 380 180 Q 405 170 430 180 Q 435 200 430 220 Q 405 230 380 220 Q 375 200 380 180 Z" class="diente-forma"/>
            <text x="405" y="200" class="diente-numero">14</text>
        </g>
        
        <!-- Diente 15 (Molar 2 superior izquierdo) -->
        <g class="diente-arco" id="diente-15" transform="rotate(-120 550 200)">
            <path d="M 380 180 Q 405 170 430 180 Q 435 200 430 220 Q 405 230 380 220 Q 375 200 380 180 Z" class="diente-forma"/>
            <text x="405" y="200" class="diente-numero">15</text>
        </g>
        
        <!-- Diente 16 (Molar 3 superior izquierdo) - extremo izquierdo -->
        <g class="diente-arco" id="diente-16" transform="rotate(-135 550 200)">
            <path d="M 380 180 Q 405 170 430 180 Q 435 200 430 220 Q 405 230 380 220 Q 375 200 380 180 Z" class="diente-forma"/>
            <text x="405" y="200" class="diente-numero">16</text>
        </g>
        
        <!-- ========================= ARCADA INFERIOR CIRCULAR ========================= -->
        <!-- Arco circular inferior siguiendo curvatura de mandÃ­bula (17-32) -->
        <!-- Centro del cÃ­rculo inferior: 550, 300 con radio 180 -->
        
        <!-- Diente 17 (Molar 3 inferior derecho) -->
        <g class="diente-arco" id="diente-17" transform="rotate(67.5 550 300)">
            <path d="M 370 280 Q 395 270 420 280 Q 425 300 420 320 Q 395 330 370 320 Q 365 300 370 280 Z" class="diente-forma"/>
            <text x="395" y="300" class="diente-numero">17</text>
        </g>
        
        <!-- Diente 18 (Molar 2 inferior derecho) -->
        <g class="diente-arco" id="diente-18" transform="rotate(56.25 550 300)">
            <path d="M 370 280 Q 395 270 420 280 Q 425 300 420 320 Q 395 330 370 320 Q 365 300 370 280 Z" class="diente-forma"/>
            <text x="395" y="300" class="diente-numero">18</text>
        </g>
        
        <!-- Diente 19 (Molar 1 inferior derecho) -->
        <g class="diente-arco" id="diente-19" transform="rotate(45 550 300)">
            <path d="M 370 280 Q 395 270 420 280 Q 425 300 420 320 Q 395 330 370 320 Q 365 300 370 280 Z" class="diente-forma"/>
            <text x="395" y="300" class="diente-numero">19</text>
        </g>
        
        <!-- Diente 20 (Premolar 2 inferior derecho) -->
        <g class="diente-arco" id="diente-20" transform="rotate(33.75 550 300)">
            <path d="M 375 285 Q 395 275 415 285 Q 420 300 415 315 Q 395 325 375 315 Q 370 300 375 285 Z" class="diente-forma"/>
            <text x="395" y="300" class="diente-numero">20</text>
        </g>
        
        <!-- Diente 21 (Premolar 1 inferior derecho) -->
        <g class="diente-arco" id="diente-21" transform="rotate(22.5 550 300)">
            <path d="M 375 285 Q 395 275 415 285 Q 420 300 415 315 Q 395 325 375 315 Q 370 300 375 285 Z" class="diente-forma"/>
            <text x="395" y="300" class="diente-numero">21</text>
        </g>
        
        <!-- Diente 22 (Canino inferior derecho) -->
        <g class="diente-arco" id="diente-22" transform="rotate(11.25 550 300)">
            <path d="M 370 280 Q 395 268 420 280 Q 425 305 420 330 Q 395 342 370 330 Q 365 305 370 280 Z" class="diente-forma"/>
            <text x="395" y="305" class="diente-numero">22</text>
        </g>
        
        <!-- Diente 23 (Incisivo lateral inferior derecho) -->
        <g class="diente-arco" id="diente-23" transform="rotate(0 550 300)">
            <path d="M 372 288 Q 390 278 408 288 Q 413 300 408 312 Q 390 322 372 312 Q 367 300 372 288 Z" class="diente-forma"/>
            <text x="390" y="300" class="diente-numero">23</text>
        </g>
        
        <!-- Diente 24 (Incisivo central inferior derecho) -->
        <g class="diente-arco" id="diente-24" transform="rotate(-11.25 550 300)">
            <path d="M 370 285 Q 392 273 414 285 Q 419 302 414 319 Q 392 331 370 319 Q 365 302 370 285 Z" class="diente-forma"/>
            <text x="392" y="302" class="diente-numero">24</text>
        </g>
        
        <!-- Diente 25 (Incisivo central inferior izquierdo) -->
        <g class="diente-arco" id="diente-25" transform="rotate(-22.5 550 300)">
            <path d="M 370 285 Q 392 273 414 285 Q 419 302 414 319 Q 392 331 370 319 Q 365 302 370 285 Z" class="diente-forma"/>
            <text x="392" y="302" class="diente-numero">25</text>
        </g>
        
        <!-- Diente 26 (Incisivo lateral inferior izquierdo) -->
        <g class="diente-arco" id="diente-26" transform="rotate(-33.75 550 300)">
            <path d="M 372 288 Q 390 278 408 288 Q 413 300 408 312 Q 390 322 372 312 Q 367 300 372 288 Z" class="diente-forma"/>
            <text x="390" y="300" class="diente-numero">26</text>
        </g>
        
        <!-- Diente 27 (Canino inferior izquierdo) -->
        <g class="diente-arco" id="diente-27" transform="rotate(-45 550 300)">
            <path d="M 370 280 Q 395 268 420 280 Q 425 305 420 330 Q 395 342 370 330 Q 365 305 370 280 Z" class="diente-forma"/>
            <text x="395" y="305" class="diente-numero">27</text>
        </g>
        
        <!-- Diente 28 (Premolar 1 inferior izquierdo) -->
        <g class="diente-arco" id="diente-28" transform="rotate(-56.25 550 300)">
            <path d="M 375 285 Q 395 275 415 285 Q 420 300 415 315 Q 395 325 375 315 Q 370 300 375 285 Z" class="diente-forma"/>
            <text x="395" y="300" class="diente-numero">28</text>
        </g>
        
        <!-- Diente 29 (Premolar 2 inferior izquierdo) -->
        <g class="diente-arco" id="diente-29" transform="rotate(-67.5 550 300)">
            <path d="M 375 285 Q 395 275 415 285 Q 420 300 415 315 Q 395 325 375 315 Q 370 300 375 285 Z" class="diente-forma"/>
            <text x="395" y="300" class="diente-numero">29</text>
        </g>
        
        <!-- Diente 30 (Molar 1 inferior izquierdo) -->
        <g class="diente-arco" id="diente-30" transform="rotate(-78.75 550 300)">
            <path d="M 370 280 Q 395 270 420 280 Q 425 300 420 320 Q 395 330 370 320 Q 365 300 370 280 Z" class="diente-forma"/>
            <text x="395" y="300" class="diente-numero">30</text>
        </g>
        
        <!-- Diente 31 (Molar 2 inferior izquierdo) -->
        <g class="diente-arco" id="diente-31" transform="rotate(-90 550 300)">
            <path d="M 370 280 Q 395 270 420 280 Q 425 300 420 320 Q 395 330 370 320 Q 365 300 370 280 Z" class="diente-forma"/>
            <text x="395" y="300" class="diente-numero">31</text>
        </g>
        
        <!-- Diente 32 (Molar 3 inferior izquierdo) -->
        <g class="diente-arco" id="diente-32" transform="rotate(-101.25 550 300)">
            <path d="M 370 280 Q 395 270 420 280 Q 425 300 420 320 Q 395 330 370 320 Q 365 300 370 280 Z" class="diente-forma"/>
            <text x="395" y="300" class="diente-numero">32</text>
        </g>
        
        <!-- ==================== PANELES SUPERNUMERARIOS ==================== -->
        
        <!-- Panel izquierdo (33-40) -->
        <rect x="20" y="200" width="70" height="320" rx="8" ry="8" class="panel-extra"/>
        <text x="55" y="190" class="etiqueta-arco" font-size="10">EXTRAS</text>
        
        <g class="diente-arco supernumerario" id="diente-33">
            <rect x="35" y="210" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="45" y="222" class="diente-numero">33</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-34">
            <rect x="35" y="245" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="45" y="257" class="diente-numero">34</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-35">
            <rect x="35" y="280" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="45" y="292" class="diente-numero">35</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-36">
            <rect x="35" y="315" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="45" y="327" class="diente-numero">36</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-37">
            <rect x="35" y="350" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="45" y="362" class="diente-numero">37</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-38">
            <rect x="35" y="385" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="45" y="397" class="diente-numero">38</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-39">
            <rect x="35" y="420" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="45" y="432" class="diente-numero">39</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-40">
            <rect x="35" y="455" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="45" y="467" class="diente-numero">40</text>
        </g>
        
        <!-- Panel derecho (41-48) -->
        <rect x="1050" y="200" width="70" height="320" rx="8" ry="8" class="panel-extra"/>
        <text x="1085" y="190" class="etiqueta-arco" font-size="10">EXTRAS</text>
        
        <g class="diente-arco supernumerario" id="diente-41">
            <rect x="1065" y="210" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="1075" y="222" class="diente-numero">41</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-42">
            <rect x="1065" y="245" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="1075" y="257" class="diente-numero">42</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-43">
            <rect x="1065" y="280" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="1075" y="292" class="diente-numero">43</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-44">
            <rect x="1065" y="315" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="1075" y="327" class="diente-numero">44</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-45">
            <rect x="1065" y="350" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="1075" y="362" class="diente-numero">45</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-46">
            <rect x="1065" y="385" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="1075" y="397" class="diente-numero">46</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-47">
            <rect x="1065" y="420" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="1075" y="432" class="diente-numero">47</text>
        </g>
        <g class="diente-arco supernumerario" id="diente-48">
            <rect x="1065" y="455" width="20" height="25" rx="3" ry="3" class="diente-forma"/>
            <text x="1075" y="467" class="diente-numero">48</text>
        </g>
    </svg>
</div>

<script>
(function() {
    'use strict';
    
    function log(mensaje) {
        console.log(`[ODONTOGRAMA ARCOS CONTIGUOS] ${mensaje}`);
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        log('Iniciando odontograma con arcos contiguos');
        
        const dientes = document.querySelectorAll('.diente-arco');
        log(`Configurando ${dientes.length} dientes contiguos`);
        
        dientes.forEach(function(diente, index) {
            diente.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                log(`Clic en ${diente.id}`);
                
                // Quitar selecciÃ³n anterior
                document.querySelectorAll('.diente-arco').forEach(d => {
                    d.classList.remove('selected');
                });
                
                // Seleccionar este diente
                diente.classList.add('selected');
                
                const numero = diente.id.replace('diente-', '');
                log(`Diente contiguo ${numero} seleccionado`);
                
                // Emitir evento compatible
                const evento = new CustomEvent('dienteSeleccionado', {
                    detail: { 
                        numero: numero, 
                        elemento: diente,
                        tipo: 'arcos-contiguos'
                    },
                    bubbles: true
                });
                
                document.dispatchEvent(evento);
                
                // Feedback visual suave
                const forma = diente.querySelector('.diente-forma');
                if (forma) {
                    const originalFilter = forma.style.filter;
                    forma.style.filter = 'brightness(1.2)';
                    setTimeout(() => {
                        forma.style.filter = originalFilter;
                    }, 200);
                }
            });
        });
        
        log('âœ… Odontograma con arcos contiguos listo - Sin espacios entre dientes');
    });
})();
</script>