{% load math_filters %}
<div id="odontograma-anatomico-container" class="odontograma-anatomico">
    <!-- Controles de vista para dispositivos pequeños -->
    <div class="controles-vista d-lg-none mb-3">
        <div class="btn-group w-100" role="group">
            <button type="button" class="btn btn-outline-primary btn-sm" data-vista="completa" id="btn-vista-completa">
                <i class="fas fa-expand"></i> Completa
            </button>
            <button type="button" class="btn btn-outline-secondary btn-sm" data-vista="superior">
                <i class="fas fa-chevron-up"></i> Superior
            </button>
            <button type="button" class="btn btn-outline-secondary btn-sm" data-vista="inferior">
                <i class="fas fa-chevron-down"></i> Inferior
            </button>
        </div>
    </div>

    <!-- SVG Principal - Boca Anatómica -->
    <svg id="odontograma-anatomico-svg" 
         class="odontograma-boca" 
         viewBox="0 0 800 600" 
         xmlns="http://www.w3.org/2000/svg"
         preserveAspectRatio="xMidYMid meet">
        
        <!-- Estilos CSS integrados -->
        <defs>
            <style>
                /* Estilos para la boca anatómica */
                .boca-exterior {
                    fill: #f4d1ae;
                    stroke: #d4a574;
                    stroke-width: 2;
                    filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
                }
                
                .boca-interior {
                    fill: #ff6b8a;
                    stroke: #e55a7a;
                    stroke-width: 1;
                }
                
                .encias {
                    fill: #ff8fa3;
                    stroke: #ff6b8a;
                    stroke-width: 1;
                }
                
                .lengua {
                    fill: #ff7a9a;
                    stroke: #e55a7a;
                    stroke-width: 1;
                    opacity: 0.8;
                }
                
                /* Estilos para los dientes */
                .diente-anatomico {
                    cursor: pointer;
                    transition: filter 0.2s ease-in-out;
                    transform-origin: center;
                }
                
                .diente-anatomico:hover {
                    filter: drop-shadow(2px 2px 6px rgba(0,0,0,0.4)) brightness(1.05);
                }
                
                .diente-anatomico.seleccionado {
                    transform: scale(1.1);
                    filter: drop-shadow(3px 3px 10px rgba(0,123,255,0.6)) brightness(1.1);
                    animation: pulso-seleccion 2s ease-in-out infinite;
                }
                
                .diente-corona {
                    fill: #ffffff;
                    stroke: #e0e0e0;
                    stroke-width: 1;
                    transition: all 0.15s ease;
                }
                
                .diente-raiz {
                    fill: #f5f5f5;
                    stroke: #d0d0d0;
                    stroke-width: 0.8;
                    opacity: 0.7;
                }
                
                .numero-diente {
                    font-size: 10px;
                    font-weight: 600;
                    fill: #666;
                    text-anchor: middle;
                    pointer-events: none;
                    font-family: Arial, sans-serif;
                }
                
                /* Supernumerarios */
                .supernumerario .diente-corona {
                    fill: #fff8dc;
                    stroke: #daa520;
                    stroke-dasharray: 2,1;
                }
                
                .supernumerario .numero-diente {
                    fill: #b8860b;
                    font-size: 8px;
                }
                
                /* Estados de diagnóstico */
                .sano .diente-corona { fill: #f0fff0; stroke: #90ee90; }
                .caries .diente-corona { fill: #ffe4e1; stroke: #dc143c; }
                .obturada .diente-corona { fill: #f5deb3; stroke: #daa520; }
                .corona .diente-corona { fill: #e6f3ff; stroke: #4169e1; }
                .extraida .diente-corona { 
                    fill: #f5f5f5; 
                    stroke: #999; 
                    stroke-dasharray: 4,2; 
                    opacity: 0.5; 
                }
                .implante .diente-corona { 
                    fill: #e8e8e8; 
                    stroke: #555; 
                    stroke-width: 2; 
                }
                .endodoncia .diente-corona { fill: #ffe4e6; stroke: #ff69b4; }
                
                /* Responsividad */
                @media (max-width: 768px) {
                    .numero-diente { font-size: 8px; }
                    .supernumerario .numero-diente { font-size: 7px; }
                }
                
                /* Ocultar/mostrar arcadas */
                .arcada.oculta {
                    opacity: 0.1;
                    pointer-events: none;
                }
                
                /* Gradientes para realismo */
                .gradient-encia-superior {
                    fill: url(#gradientEnciasSuperior);
                }
                
                .gradient-encia-inferior {
                    fill: url(#gradientEnciasInferior);
                }
            </style>
            
            <!-- Gradientes para las encías -->
            <linearGradient id="gradientEnciasSuperior" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#ffb3ba;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#ff8fa3;stop-opacity:1" />
            </linearGradient>
            
            <linearGradient id="gradientEnciasInferior" x1="0%" y1="100%" x2="0%" y2="0%">
                <stop offset="0%" style="stop-color:#ffb3ba;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#ff8fa3;stop-opacity:1" />
            </linearGradient>
            
            <!-- Gradiente para dientes -->
            <linearGradient id="gradientDiente" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                <stop offset="70%" style="stop-color:#fafafa;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#f0f0f0;stop-opacity:1" />
            </linearGradient>
            
            <!-- Sombra para dientes -->
            <filter id="sombra-diente">
                <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.3"/>
            </filter>
        </defs>

        <!-- Contorno exterior de la boca -->
        <ellipse cx="400" cy="300" rx="350" ry="200" class="boca-exterior"/>
        
        <!-- Interior de la boca -->
        <ellipse cx="400" cy="300" rx="330" ry="180" class="boca-interior"/>
        
        <!-- Lengua (parcialmente visible) -->
        <ellipse cx="400" cy="380" rx="120" ry="60" class="lengua"/>

        <!-- ARCADA SUPERIOR -->
        <g id="arcada-superior" class="arcada">
            <!-- Encías superior -->
            <path d="M 120 260 Q 400 180 680 260 Q 400 240 120 260 Z" class="encias gradient-encia-superior"/>
            
            <!-- CUADRANTE I (Superior Derecho) -->
            <g id="cuadrante-1">
                <!-- Tercer molar (18) -->
                <g class="diente-anatomico" id="diente-18" transform="translate(140, 240)">
                    <path class="diente-corona" d="M-10,-13 Q-10,-19 -6,-22 Q-2,-23 0,-23 Q2,-23 6,-22 Q10,-19 10,-13 L10,9 Q10,13 6,15 Q2,16 0,16 Q-2,16 -6,15 Q-10,13 -10,9 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-6,15 Q-6,24 -2,26 Q0,27 2,26 Q6,24 6,15"/>
                    <text class="numero-diente" x="0" y="-3">18</text>
                </g>
                
                <!-- Segundo molar (17) -->
                <g class="diente-anatomico" id="diente-17" transform="translate(170, 235)">
                    <path class="diente-corona" d="M-11,-15 Q-11,-21 -7,-24 Q-3,-25 0,-25 Q3,-25 7,-24 Q11,-21 11,-15 L11,11 Q11,15 7,17 Q3,18 0,18 Q-3,18 -7,17 Q-11,15 -11,11 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-7,17 Q-7,26 -3,28 Q0,29 3,28 Q7,26 7,17"/>
                    <text class="numero-diente" x="0" y="-3">17</text>
                </g>
                
                <!-- Primer molar (16) -->
                <g class="diente-anatomico" id="diente-16" transform="translate(205, 228)">
                    <path class="diente-corona" d="M-12,-16 Q-12,-22 -8,-25 Q-4,-26 0,-26 Q4,-26 8,-25 Q12,-22 12,-16 L12,12 Q12,16 8,18 Q4,19 0,19 Q-4,19 -8,18 Q-12,16 -12,12 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-8,18 Q-8,28 -4,30 Q0,31 4,30 Q8,28 8,18"/>
                    <text class="numero-diente" x="0" y="-3">16</text>
                </g>
                
                <!-- Segundo premolar (15) -->
                <g class="diente-anatomico" id="diente-15" transform="translate(245, 220)">
                    <path class="diente-corona" d="M-9,-14 Q-9,-18 -5,-20 Q0,-21 5,-20 Q9,-18 9,-14 L9,10 Q9,14 5,16 Q0,17 -5,16 Q-9,14 -9,10 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-5,16 Q-5,23 0,25 Q5,23 5,16"/>
                    <text class="numero-diente" x="0" y="-2">15</text>
                </g>
                
                <!-- Primer premolar (14) -->
                <g class="diente-anatomico" id="diente-14" transform="translate(285, 215)">
                    <path class="diente-corona" d="M-9,-14 Q-9,-18 -5,-20 Q0,-21 5,-20 Q9,-18 9,-14 L9,10 Q9,14 5,16 Q0,17 -5,16 Q-9,14 -9,10 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-5,16 Q-5,23 0,25 Q5,23 5,16"/>
                    <text class="numero-diente" x="0" y="-2">14</text>
                </g>
                
                <!-- Canino (13) -->
                <g class="diente-anatomico" id="diente-13" transform="translate(325, 210)">
                    <path class="diente-corona" d="M-8,-12 Q-8,-16 -4,-20 Q0,-22 4,-20 Q8,-16 8,-12 L8,8 Q8,12 4,14 Q0,15 -4,14 Q-8,12 -8,8 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-4,14 Q-4,25 0,28 Q4,25 4,14"/>
                    <text class="numero-diente" x="0" y="-2">13</text>
                </g>
                
                <!-- Incisivo lateral (12) -->
                <g class="diente-anatomico" id="diente-12" transform="translate(355, 208)">
                    <path class="diente-corona" d="M-7,-12 Q-7,-16 -3,-18 Q0,-19 3,-18 Q7,-16 7,-12 L7,6 Q7,10 3,12 Q0,13 -3,12 Q-7,10 -7,6 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-3,12 Q-3,19 0,21 Q3,19 3,12"/>
                    <text class="numero-diente" x="0" y="-1">12</text>
                </g>
                
                <!-- Incisivo central (11) -->
                <g class="diente-anatomico" id="diente-11" transform="translate(385, 207)">
                    <path class="diente-corona" d="M-8,-14 Q-8,-18 -4,-20 Q0,-21 4,-20 Q8,-18 8,-14 L8,8 Q8,12 4,14 Q0,15 -4,14 Q-8,12 -8,8 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-4,14 Q-4,22 0,24 Q4,22 4,14"/>
                    <text class="numero-diente" x="0" y="-2">11</text>
                </g>
                
                <!-- Supernumerarios cuadrante 1 -->
                <g class="diente-anatomico supernumerario" id="diente-19" transform="translate(115, 245)">
                    <path class="diente-corona" d="M-5,-8 Q-5,-12 0,-12 Q5,-12 5,-8 L5,6 Q5,10 0,10 Q-5,10 -5,6 Z" filter="url(#sombra-diente)"/>
                    <text class="numero-diente" x="0" y="0">19</text>
                </g>
                
                <g class="diente-anatomico supernumerario" id="diente-110" transform="translate(325, 190)">
                    <path class="diente-corona" d="M-4,-6 Q-4,-8 0,-8 Q4,-8 4,-6 L4,4 Q4,6 0,6 Q-4,6 -4,4 Z" filter="url(#sombra-diente)"/>
                    <text class="numero-diente" x="0" y="0">110</text>
                </g>
            </g>
            
            <!-- CUADRANTE II (Superior Izquierdo) -->
            <g id="cuadrante-2">
                <!-- Incisivo central (21) -->
                <g class="diente-anatomico" id="diente-21" transform="translate(415, 207)">
                    <path class="diente-corona" d="M-8,-14 Q-8,-18 -4,-20 Q0,-21 4,-20 Q8,-18 8,-14 L8,8 Q8,12 4,14 Q0,15 -4,14 Q-8,12 -8,8 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-4,14 Q-4,22 0,24 Q4,22 4,14"/>
                    <text class="numero-diente" x="0" y="-2">21</text>
                </g>
                
                <!-- Incisivo lateral (22) -->
                <g class="diente-anatomico" id="diente-22" transform="translate(445, 208)">
                    <path class="diente-corona" d="M-7,-12 Q-7,-16 -3,-18 Q0,-19 3,-18 Q7,-16 7,-12 L7,6 Q7,10 3,12 Q0,13 -3,12 Q-7,10 -7,6 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-3,12 Q-3,19 0,21 Q3,19 3,12"/>
                    <text class="numero-diente" x="0" y="-1">22</text>
                </g>
                
                <!-- Canino (23) -->
                <g class="diente-anatomico" id="diente-23" transform="translate(475, 210)">
                    <path class="diente-corona" d="M-8,-12 Q-8,-16 -4,-20 Q0,-22 4,-20 Q8,-16 8,-12 L8,8 Q8,12 4,14 Q0,15 -4,14 Q-8,12 -8,8 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-4,14 Q-4,25 0,28 Q4,25 4,14"/>
                    <text class="numero-diente" x="0" y="-2">23</text>
                </g>
                
                <!-- Primer premolar (24) -->
                <g class="diente-anatomico" id="diente-24" transform="translate(515, 215)">
                    <path class="diente-corona" d="M-9,-14 Q-9,-18 -5,-20 Q0,-21 5,-20 Q9,-18 9,-14 L9,10 Q9,14 5,16 Q0,17 -5,16 Q-9,14 -9,10 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-5,16 Q-5,23 0,25 Q5,23 5,16"/>
                    <text class="numero-diente" x="0" y="-2">24</text>
                </g>
                
                <!-- Segundo premolar (25) -->
                <g class="diente-anatomico" id="diente-25" transform="translate(555, 220)">
                    <path class="diente-corona" d="M-9,-14 Q-9,-18 -5,-20 Q0,-21 5,-20 Q9,-18 9,-14 L9,10 Q9,14 5,16 Q0,17 -5,16 Q-9,14 -9,10 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-5,16 Q-5,23 0,25 Q5,23 5,16"/>
                    <text class="numero-diente" x="0" y="-2">25</text>
                </g>
                
                <!-- Primer molar (26) -->
                <g class="diente-anatomico" id="diente-26" transform="translate(595, 228)">
                    <path class="diente-corona" d="M-12,-16 Q-12,-22 -8,-25 Q-4,-26 0,-26 Q4,-26 8,-25 Q12,-22 12,-16 L12,12 Q12,16 8,18 Q4,19 0,19 Q-4,19 -8,18 Q-12,16 -12,12 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-8,18 Q-8,28 -4,30 Q0,31 4,30 Q8,28 8,18"/>
                    <text class="numero-diente" x="0" y="-3">26</text>
                </g>
                
                <!-- Segundo molar (27) -->
                <g class="diente-anatomico" id="diente-27" transform="translate(630, 235)">
                    <path class="diente-corona" d="M-11,-15 Q-11,-21 -7,-24 Q-3,-25 0,-25 Q3,-25 7,-24 Q11,-21 11,-15 L11,11 Q11,15 7,17 Q3,18 0,18 Q-3,18 -7,17 Q-11,15 -11,11 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-7,17 Q-7,26 -3,28 Q0,29 3,28 Q7,26 7,17"/>
                    <text class="numero-diente" x="0" y="-3">27</text>
                </g>
                
                <!-- Tercer molar (28) -->
                <g class="diente-anatomico" id="diente-28" transform="translate(660, 240)">
                    <path class="diente-corona" d="M-10,-13 Q-10,-19 -6,-22 Q-2,-23 0,-23 Q2,-23 6,-22 Q10,-19 10,-13 L10,9 Q10,13 6,15 Q2,16 0,16 Q-2,16 -6,15 Q-10,13 -10,9 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-6,15 Q-6,24 -2,26 Q0,27 2,26 Q6,24 6,15"/>
                    <text class="numero-diente" x="0" y="-3">28</text>
                </g>
                
                <!-- Supernumerarios cuadrante 2 -->
                <g class="diente-anatomico supernumerario" id="diente-29" transform="translate(685, 245)">
                    <path class="diente-corona" d="M-5,-8 Q-5,-12 0,-12 Q5,-12 5,-8 L5,6 Q5,10 0,10 Q-5,10 -5,6 Z" filter="url(#sombra-diente)"/>
                    <text class="numero-diente" x="0" y="0">29</text>
                </g>
                
                <g class="diente-anatomico supernumerario" id="diente-210" transform="translate(475, 190)">
                    <path class="diente-corona" d="M-4,-6 Q-4,-8 0,-8 Q4,-8 4,-6 L4,4 Q4,6 0,6 Q-4,6 -4,4 Z" filter="url(#sombra-diente)"/>
                    <text class="numero-diente" x="0" y="0">210</text>
                </g>
            </g>
        </g>

        <!-- ARCADA INFERIOR -->
        <g id="arcada-inferior" class="arcada">
            <!-- Encías inferior -->
            <path d="M 120 340 Q 400 360 680 340 Q 400 420 120 340 Z" class="encias gradient-encia-inferior"/>
            
            <!-- CUADRANTE III (Inferior Izquierdo) -->
            <g id="cuadrante-3">
                <!-- Incisivo central (31) -->
                <g class="diente-anatomico" id="diente-31" transform="translate(415, 393) scale(1, -1)">
                    <path class="diente-corona" d="M-6,-10 Q-6,-14 -3,-16 Q0,-17 3,-16 Q6,-14 6,-10 L6,6 Q6,10 3,12 Q0,13 -3,12 Q-6,10 -6,6 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-3,12 Q-3,20 0,22 Q3,20 3,12"/>
                    <text class="numero-diente" x="0" y="-1" transform="scale(1, -1)">31</text>
                </g>
                
                <!-- Incisivo lateral (32) -->
                <g class="diente-anatomico" id="diente-32" transform="translate(445, 392) scale(1, -1)">
                    <path class="diente-corona" d="M-5,-7 Q-5,-11 0,-11 Q5,-11 5,-7 L5,3 Q5,7 0,7 Q-5,7 -5,3 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-2,7 Q-2,13 0,13 Q2,13 2,7"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">32</text>
                </g>
                
                <!-- Canino (33) -->
                <g class="diente-anatomico" id="diente-33" transform="translate(475, 390) scale(1, -1)">
                    <path class="diente-corona" d="M-6,-8 Q-6,-12 0,-14 Q6,-12 6,-8 L6,4 Q6,8 0,8 Q-6,8 -6,4 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-3,8 Q-3,14 0,16 Q3,14 3,8"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">33</text>
                </g>
                
                <!-- Primer premolar (34) -->
                <g class="diente-anatomico" id="diente-34" transform="translate(515, 385) scale(1, -1)">
                    <path class="diente-corona" d="M-7,-10 Q-7,-14 0,-14 Q7,-14 7,-10 L7,6 Q7,10 0,10 Q-7,10 -7,6 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-4,10 Q-4,16 0,16 Q4,16 4,10"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">34</text>
                </g>
                
                <!-- Segundo premolar (35) -->
                <g class="diente-anatomico" id="diente-35" transform="translate(555, 380) scale(1, -1)">
                    <path class="diente-corona" d="M-8,-12 Q-8,-16 0,-16 Q8,-16 8,-12 L8,8 Q8,12 0,12 Q-8,12 -8,8 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-4,12 Q-4,18 0,18 Q4,18 4,12"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">35</text>
                </g>
                
                <!-- Primer molar (36) -->
                <g class="diente-anatomico" id="diente-36" transform="translate(595, 372) scale(1, -1)">
                    <path class="diente-corona" d="M-10,-14 Q-10,-20 0,-20 Q10,-20 10,-14 L10,10 Q10,14 0,14 Q-10,14 -10,10 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-8,14 Q-8,23 0,23 Q8,23 8,14"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">36</text>
                </g>
                
                <!-- Segundo molar (37) -->
                <g class="diente-anatomico" id="diente-37" transform="translate(630, 365) scale(1, -1)">
                    <path class="diente-corona" d="M-9,-12 Q-9,-18 0,-18 Q9,-18 9,-12 L9,8 Q9,12 0,12 Q-9,12 -9,8 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-7,12 Q-7,20 0,20 Q7,20 7,12"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">37</text>
                </g>
                
                <!-- Tercer molar (38) -->
                <g class="diente-anatomico" id="diente-38" transform="translate(660, 360) scale(1, -1)">
                    <path class="diente-corona" d="M-8,-10 Q-8,-16 0,-16 Q8,-16 8,-10 L8,6 Q8,10 0,10 Q-8,10 -8,6 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-6,10 Q-6,18 0,18 Q6,18 6,10"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">38</text>
                </g>
                
                <!-- Supernumerarios cuadrante 3 -->
                <g class="diente-anatomico supernumerario" id="diente-39" transform="translate(685, 355) scale(1, -1)">
                    <path class="diente-corona" d="M-5,-6 Q-5,-10 0,-10 Q5,-10 5,-6 L5,4 Q5,8 0,8 Q-5,8 -5,4 Z" filter="url(#sombra-diente)"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">39</text>
                </g>
                
                <g class="diente-anatomico supernumerario" id="diente-310" transform="translate(475, 410) scale(1, -1)">
                    <path class="diente-corona" d="M-4,-4 Q-4,-6 0,-6 Q4,-6 4,-4 L4,2 Q4,4 0,4 Q-4,4 -4,2 Z" filter="url(#sombra-diente)"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">310</text>
                </g>
            </g>
            
            <!-- CUADRANTE IV (Inferior Derecho) -->
            <g id="cuadrante-4">
                <!-- Incisivo central (41) -->
                <g class="diente-anatomico" id="diente-41" transform="translate(385, 393) scale(1, -1)">
                    <path class="diente-corona" d="M-6,-10 Q-6,-14 -3,-16 Q0,-17 3,-16 Q6,-14 6,-10 L6,6 Q6,10 3,12 Q0,13 -3,12 Q-6,10 -6,6 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-3,12 Q-3,20 0,22 Q3,20 3,12"/>
                    <text class="numero-diente" x="0" y="-1" transform="scale(1, -1)">41</text>
                </g>
                
                <!-- Incisivo lateral (42) -->
                <g class="diente-anatomico" id="diente-42" transform="translate(355, 392) scale(1, -1)">
                    <path class="diente-corona" d="M-5,-7 Q-5,-11 0,-11 Q5,-11 5,-7 L5,3 Q5,7 0,7 Q-5,7 -5,3 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-2,7 Q-2,13 0,13 Q2,13 2,7"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">42</text>
                </g>
                
                <!-- Canino (43) -->
                <g class="diente-anatomico" id="diente-43" transform="translate(325, 390) scale(1, -1)">
                    <path class="diente-corona" d="M-6,-8 Q-6,-12 0,-14 Q6,-12 6,-8 L6,4 Q6,8 0,8 Q-6,8 -6,4 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-3,8 Q-3,14 0,16 Q3,14 3,8"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">43</text>
                </g>
                
                <!-- Primer premolar (44) -->
                <g class="diente-anatomico" id="diente-44" transform="translate(285, 385) scale(1, -1)">
                    <path class="diente-corona" d="M-7,-10 Q-7,-14 0,-14 Q7,-14 7,-10 L7,6 Q7,10 0,10 Q-7,10 -7,6 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-4,10 Q-4,16 0,16 Q4,16 4,10"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">44</text>
                </g>
                
                <!-- Segundo premolar (45) -->
                <g class="diente-anatomico" id="diente-45" transform="translate(245, 380) scale(1, -1)">
                    <path class="diente-corona" d="M-8,-12 Q-8,-16 0,-16 Q8,-16 8,-12 L8,8 Q8,12 0,12 Q-8,12 -8,8 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-4,12 Q-4,18 0,18 Q4,18 4,12"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">45</text>
                </g>
                
                <!-- Primer molar (46) -->
                <g class="diente-anatomico" id="diente-46" transform="translate(205, 372) scale(1, -1)">
                    <path class="diente-corona" d="M-10,-14 Q-10,-20 0,-20 Q10,-20 10,-14 L10,10 Q10,14 0,14 Q-10,14 -10,10 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-8,14 Q-8,23 0,23 Q8,23 8,14"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">46</text>
                </g>
                
                <!-- Segundo molar (47) -->
                <g class="diente-anatomico" id="diente-47" transform="translate(170, 365) scale(1, -1)">
                    <path class="diente-corona" d="M-9,-12 Q-9,-18 0,-18 Q9,-18 9,-12 L9,8 Q9,12 0,12 Q-9,12 -9,8 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-7,12 Q-7,20 0,20 Q7,20 7,12"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">47</text>
                </g>
                
                <!-- Tercer molar (48) -->
                <g class="diente-anatomico" id="diente-48" transform="translate(140, 360) scale(1, -1)">
                    <path class="diente-corona" d="M-8,-10 Q-8,-16 0,-16 Q8,-16 8,-10 L8,6 Q8,10 0,10 Q-8,10 -8,6 Z" filter="url(#sombra-diente)"/>
                    <path class="diente-raiz" d="M-6,10 Q-6,18 0,18 Q6,18 6,10"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">48</text>
                </g>
                
                <!-- Supernumerarios cuadrante 4 -->
                <g class="diente-anatomico supernumerario" id="diente-49" transform="translate(115, 355) scale(1, -1)">
                    <path class="diente-corona" d="M-5,-6 Q-5,-10 0,-10 Q5,-10 5,-6 L5,4 Q5,8 0,8 Q-5,8 -5,4 Z" filter="url(#sombra-diente)"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">49</text>
                </g>
                
                <g class="diente-anatomico supernumerario" id="diente-410" transform="translate(325, 410) scale(1, -1)">
                    <path class="diente-corona" d="M-4,-4 Q-4,-6 0,-6 Q4,-6 4,-4 L4,2 Q4,4 0,4 Q-4,4 -4,2 Z" filter="url(#sombra-diente)"/>
                    <text class="numero-diente" x="0" y="0" transform="scale(1, -1)">410</text>
                </g>
            </g>
        </g>
        
        <!-- Etiquetas de información -->
        <g id="info-labels" class="d-none d-lg-block">
            <rect x="20" y="520" width="200" height="60" fill="rgba(255,255,255,0.95)" stroke="#ddd" rx="8"/>
            <text x="30" y="540" font-size="12" font-weight="bold" fill="#333">Odontograma Anatómico</text>
            <text x="30" y="555" font-size="10" fill="#666">48 Dientes - Vista Realista</text>
            <text x="30" y="570" font-size="9" fill="#999">Click en un diente para seleccionar</text>
        </g>
    </svg>
</div>

<style>
/* Estilos específicos para el odontograma anatómico */
.odontograma-anatomico {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.odontograma-boca {
    width: 100%;
    height: auto;
    max-height: 80vh;
    border-radius: 12px;
    background: linear-gradient(45deg, #fff 0%, #f8f9fa 100%);
    border: 2px solid #e9ecef;
}

.controles-vista .btn {
    font-size: 0.8rem;
    padding: 0.4rem 0.8rem;
}

.controles-vista .btn.active {
    background-color: #007bff;
    border-color: #007bff;
    color: white;
}

/* Animaciones suaves */
.diente-anatomico {
    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

.diente-anatomico:hover {
    cursor: pointer;
}

/* Responsividad */
@media (max-width: 768px) {
    .odontograma-anatomico {
        padding: 15px;
    }
    
    .odontograma-boca {
        max-height: 60vh;
    }
}

@media (max-width: 576px) {
    .odontograma-boca {
        max-height: 50vh;
    }
    
    .controles-vista .btn {
        font-size: 0.75rem;
        padding: 0.3rem 0.6rem;
    }
}

/* Estados especiales para dientes seleccionados */
.diente-seleccionado-activo {
    animation: pulso-seleccion 1.5s ease-in-out infinite;
}

@keyframes pulso-seleccion {
    0%, 100% { 
        transform: scale(1.1);
        filter: drop-shadow(3px 3px 10px rgba(0,123,255,0.6)) brightness(1.1);
    }
    50% { 
        transform: scale(1.12);
        filter: drop-shadow(4px 4px 12px rgba(0,123,255,0.8)) brightness(1.15);
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar el odontograma anatómico
    const odontogramaAnatomico = new OdontogramaAnatomico();
});

class OdontogramaAnatomico {
    constructor() {
        this.dienteSeleccionado = null;
        this.init();
    }
    
    init() {
        this.configurarEventosDientes();
        this.configurarControlesVista();
        this.configurarResponsividad();
    }
    
    configurarEventosDientes() {
        document.querySelectorAll('.diente-anatomico').forEach(diente => {
            diente.addEventListener('click', (e) => {
                e.stopPropagation();
                this.seleccionarDiente(diente);
            });
            
            // NO aplicar transformaciones en hover - solo usar CSS
            // Los estilos de hover están manejados completamente por CSS
        });
    }
    
    seleccionarDiente(dienteElement) {
        // Remover selección anterior
        document.querySelectorAll('.diente-anatomico').forEach(d => {
            d.classList.remove('seleccionado', 'diente-seleccionado-activo');
            d.style.transform = 'scale(1)';
        });
        
        // Seleccionar nuevo diente
        dienteElement.classList.add('seleccionado', 'diente-seleccionado-activo');
        this.dienteSeleccionado = dienteElement;
        
        const numeroDiente = dienteElement.id.replace('diente-', '');
        
        // Disparar evento personalizado para que lo capture el sistema principal
        const evento = new CustomEvent('dienteSeleccionado', {
            detail: {
                numeroDiente: numeroDiente,
                elemento: dienteElement
            }
        });
        
        document.dispatchEvent(evento);
        
        console.log('Diente seleccionado:', numeroDiente);
    }
    
    configurarControlesVista() {
        const botones = document.querySelectorAll('[data-vista]');
        
        botones.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const vista = e.currentTarget.dataset.vista;
                this.cambiarVista(vista);
                
                // Actualizar botones activos
                botones.forEach(b => {
                    b.classList.remove('btn-primary', 'active');
                    b.classList.add('btn-outline-secondary');
                });
                
                e.currentTarget.classList.remove('btn-outline-secondary');
                e.currentTarget.classList.add('btn-primary', 'active');
            });
        });
    }
    
    cambiarVista(tipoVista) {
        const arcadaSuperior = document.getElementById('arcada-superior');
        const arcadaInferior = document.getElementById('arcada-inferior');
        
        switch(tipoVista) {
            case 'superior':
                arcadaSuperior.classList.remove('oculta');
                arcadaInferior.classList.add('oculta');
                break;
                
            case 'inferior':
                arcadaSuperior.classList.add('oculta');
                arcadaInferior.classList.remove('oculta');
                break;
                
            case 'completa':
            default:
                arcadaSuperior.classList.remove('oculta');
                arcadaInferior.classList.remove('oculta');
                break;
        }
    }
    
    configurarResponsividad() {
        // Inicializar vista según tamaño de pantalla
        if (window.innerWidth >= 992) {
            document.getElementById('btn-vista-completa')?.click();
        } else {
            // En pantallas pequeñas, empezar con vista completa pero permitir navegación
            document.querySelector('[data-vista="completa"]')?.click();
        }
        
        // Escuchar cambios de tamaño
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 992) {
                // Asegurar que en pantallas grandes se vea completo
                this.cambiarVista('completa');
            }
        });
    }
    
    // Método para aplicar estado de diagnóstico desde el sistema principal
    aplicarDiagnostico(numeroDiente, diagnostico, color) {
        const diente = document.getElementById(`diente-${numeroDiente}`);
        if (diente) {
            // Remover clases de diagnóstico anteriores
            diente.classList.remove('sano', 'caries', 'obturada', 'corona', 'extraida', 'implante', 'endodoncia');
            
            // Aplicar nueva clase
            diente.classList.add(diagnostico.toLowerCase());
            
            // Aplicar color personalizado si existe
            const corona = diente.querySelector('.diente-corona');
            if (corona && color) {
                corona.style.fill = color;
            }
        }
    }
    
    // Método para limpiar diente
    limpiarDiente(numeroDiente) {
        const diente = document.getElementById(`diente-${numeroDiente}`);
        if (diente) {
            diente.classList.remove('caries', 'obturada', 'corona', 'extraida', 'implante', 'endodoncia');
            diente.classList.add('sano');
            
            const corona = diente.querySelector('.diente-corona');
            if (corona) {
                corona.style.fill = '#ffffff';
            }
        }
    }
}

// Hacer la clase disponible globalmente
window.OdontogramaAnatomico = OdontogramaAnatomico;
</script>