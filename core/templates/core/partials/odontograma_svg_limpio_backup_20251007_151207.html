{% load math_filters %}
<div id="odontograma-svg-limpio" style="max-width: 1000px; margin: 0 auto; padding: 20px;">
    <style>
        .odontograma-svg-limpio svg {
            width: 100%;
            height: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #ffffff;
        }
        
        .diente-svg {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .diente-svg:hover {
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }
        
        .diente-svg.selected {
            filter: drop-shadow(0 0 8px rgba(0,123,255,0.8));
        }
        
        .diente-forma {
            fill: #ffffff;
            stroke: #666666;
            stroke-width: 2;
            transition: all 0.3s ease;
        }
        
        .diente-numero {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 14px;
            font-weight: bold;
            fill: #333333;
            text-anchor: middle;
            pointer-events: none;
            dominant-baseline: central;
        }
        
        /* Estados de diagnóstico - COLORES MUY EVIDENTES */
        .diente-svg.sano .diente-forma { 
            fill: #4caf50 !important; 
            stroke: #1b5e20 !important; 
            stroke-width: 4 !important;
            filter: drop-shadow(0 0 6px #4caf50);
        }
        .diente-svg.caries .diente-forma { 
            fill: #f44336 !important; 
            stroke: #b71c1c !important; 
            stroke-width: 4 !important;
            filter: drop-shadow(0 0 6px #f44336);
        }
        .diente-svg.obturada .diente-forma { 
            fill: #ffc107 !important; 
            stroke: #e65100 !important; 
            stroke-width: 4 !important;
            filter: drop-shadow(0 0 6px #ffc107);
        }
        .diente-svg.corona .diente-forma { 
            fill: #2196f3 !important; 
            stroke: #0d47a1 !important; 
            stroke-width: 4 !important;
            filter: drop-shadow(0 0 6px #2196f3);
        }
        .diente-svg.extraida .diente-forma { 
            fill: #616161 !important; 
            stroke: #212121 !important; 
            stroke-dasharray: 10,5 !important; 
            stroke-width: 4 !important;
            opacity: 0.9;
            filter: drop-shadow(0 0 6px #616161);
        }
        .diente-svg.implante .diente-forma { 
            fill: #607d8b !important; 
            stroke: #263238 !important; 
            stroke-width: 5 !important;
            filter: drop-shadow(0 0 6px #607d8b);
        }
        .diente-svg.endodoncia .diente-forma { 
            fill: #e91e63 !important; 
            stroke: #880e4f !important; 
            stroke-width: 4 !important;
            filter: drop-shadow(0 0 6px #e91e63);
        }
    </style>
    
    <h4 style="text-align: center; color: #666; margin-bottom: 20px;">Odontograma - 48 Dientes</h4>
    
    <svg viewBox="0 0 1000 600" xmlns="http://www.w3.org/2000/svg">
        <!-- Fondo y líneas de referencia -->
        <rect width="1000" height="600" fill="#f8f9fa"/>
        <line x1="500" y1="50" x2="500" y2="550" stroke="#e0e0e0" stroke-width="1"/>
        <line x1="50" y1="300" x2="950" y2="300" stroke="#e0e0e0" stroke-width="2"/>
        
        <!-- Etiquetas -->
        <text x="500" y="35" font-size="18" font-weight="bold" fill="#666" text-anchor="middle">ARCADA SUPERIOR</text>
        <text x="500" y="580" font-size="18" font-weight="bold" fill="#666" text-anchor="middle">ARCADA INFERIOR</text>
        
        <!-- ARCADA SUPERIOR (1-16) -->
        <g class="diente-svg" id="diente-1"><rect x="100" y="80" width="40" height="50" rx="8" class="diente-forma"/><text x="120" y="105" class="diente-numero">1</text></g>
        <g class="diente-svg" id="diente-2"><rect x="150" y="85" width="40" height="50" rx="8" class="diente-forma"/><text x="170" y="110" class="diente-numero">2</text></g>
        <g class="diente-svg" id="diente-3"><rect x="200" y="90" width="40" height="50" rx="8" class="diente-forma"/><text x="220" y="115" class="diente-numero">3</text></g>
        <g class="diente-svg" id="diente-4"><rect x="250" y="95" width="35" height="45" rx="6" class="diente-forma"/><text x="267.5" y="117.5" class="diente-numero">4</text></g>
        <g class="diente-svg" id="diente-5"><rect x="295" y="100" width="35" height="45" rx="6" class="diente-forma"/><text x="312.5" y="122.5" class="diente-numero">5</text></g>
        <g class="diente-svg" id="diente-6"><polygon points="340,105 370,105 365,155 345,155" class="diente-forma"/><text x="357.5" y="130" class="diente-numero">6</text></g>
        <g class="diente-svg" id="diente-7"><rect x="380" y="110" width="30" height="40" rx="5" class="diente-forma"/><text x="395" y="130" class="diente-numero">7</text></g>
        <g class="diente-svg" id="diente-8"><rect x="420" y="115" width="32" height="40" rx="5" class="diente-forma"/><text x="436" y="135" class="diente-numero">8</text></g>
        <g class="diente-svg" id="diente-9"><rect x="462" y="115" width="32" height="40" rx="5" class="diente-forma"/><text x="478" y="135" class="diente-numero">9</text></g>
        <g class="diente-svg" id="diente-10"><rect x="504" y="110" width="30" height="40" rx="5" class="diente-forma"/><text x="519" y="130" class="diente-numero">10</text></g>
        <g class="diente-svg" id="diente-11"><polygon points="544,105 574,105 569,155 549,155" class="diente-forma"/><text x="561.5" y="130" class="diente-numero">11</text></g>
        <g class="diente-svg" id="diente-12"><rect x="584" y="100" width="35" height="45" rx="6" class="diente-forma"/><text x="601.5" y="122.5" class="diente-numero">12</text></g>
        <g class="diente-svg" id="diente-13"><rect x="629" y="95" width="35" height="45" rx="6" class="diente-forma"/><text x="646.5" y="117.5" class="diente-numero">13</text></g>
        <g class="diente-svg" id="diente-14"><rect x="674" y="90" width="40" height="50" rx="8" class="diente-forma"/><text x="694" y="115" class="diente-numero">14</text></g>
        <g class="diente-svg" id="diente-15"><rect x="724" y="85" width="40" height="50" rx="8" class="diente-forma"/><text x="744" y="110" class="diente-numero">15</text></g>
        <g class="diente-svg" id="diente-16"><rect x="774" y="80" width="40" height="50" rx="8" class="diente-forma"/><text x="794" y="105" class="diente-numero">16</text></g>
        
        <!-- ARCADA INFERIOR (17-32) -->
        <g class="diente-svg" id="diente-17"><rect x="100" y="470" width="40" height="50" rx="8" class="diente-forma"/><text x="120" y="495" class="diente-numero">17</text></g>
        <g class="diente-svg" id="diente-18"><rect x="150" y="465" width="40" height="50" rx="8" class="diente-forma"/><text x="170" y="490" class="diente-numero">18</text></g>
        <g class="diente-svg" id="diente-19"><rect x="200" y="460" width="40" height="50" rx="8" class="diente-forma"/><text x="220" y="485" class="diente-numero">19</text></g>
        <g class="diente-svg" id="diente-20"><rect x="250" y="455" width="35" height="45" rx="6" class="diente-forma"/><text x="267.5" y="477.5" class="diente-numero">20</text></g>
        <g class="diente-svg" id="diente-21"><rect x="295" y="450" width="35" height="45" rx="6" class="diente-forma"/><text x="312.5" y="472.5" class="diente-numero">21</text></g>
        <g class="diente-svg" id="diente-22"><polygon points="340,445 370,445 365,495 345,495" class="diente-forma"/><text x="357.5" y="470" class="diente-numero">22</text></g>
        <g class="diente-svg" id="diente-23"><rect x="380" y="450" width="30" height="40" rx="5" class="diente-forma"/><text x="395" y="470" class="diente-numero">23</text></g>
        <g class="diente-svg" id="diente-24"><rect x="420" y="445" width="32" height="40" rx="5" class="diente-forma"/><text x="436" y="465" class="diente-numero">24</text></g>
        <g class="diente-svg" id="diente-25"><rect x="462" y="445" width="32" height="40" rx="5" class="diente-forma"/><text x="478" y="465" class="diente-numero">25</text></g>
        <g class="diente-svg" id="diente-26"><rect x="504" y="450" width="30" height="40" rx="5" class="diente-forma"/><text x="519" y="470" class="diente-numero">26</text></g>
        <g class="diente-svg" id="diente-27"><polygon points="544,445 574,445 569,495 549,495" class="diente-forma"/><text x="561.5" y="470" class="diente-numero">27</text></g>
        <g class="diente-svg" id="diente-28"><rect x="584" y="450" width="35" height="45" rx="6" class="diente-forma"/><text x="601.5" y="472.5" class="diente-numero">28</text></g>
        <g class="diente-svg" id="diente-29"><rect x="629" y="455" width="35" height="45" rx="6" class="diente-forma"/><text x="646.5" y="477.5" class="diente-numero">29</text></g>
        <g class="diente-svg" id="diente-30"><rect x="674" y="460" width="40" height="50" rx="8" class="diente-forma"/><text x="694" y="485" class="diente-numero">30</text></g>
        <g class="diente-svg" id="diente-31"><rect x="724" y="465" width="40" height="50" rx="8" class="diente-forma"/><text x="744" y="490" class="diente-numero">31</text></g>
        <g class="diente-svg" id="diente-32"><rect x="774" y="470" width="40" height="50" rx="8" class="diente-forma"/><text x="794" y="495" class="diente-numero">32</text></g>
        
        <!-- SUPERNUMERARIOS (33-48) - Más pequeños -->
        <g class="diente-svg" id="diente-33"><circle cx="80" cy="80" r="15" class="diente-forma"/><text x="80" y="80" class="diente-numero" font-size="12">33</text></g>
        <g class="diente-svg" id="diente-34"><circle cx="834" cy="80" r="15" class="diente-forma"/><text x="834" y="80" class="diente-numero" font-size="12">34</text></g>
        <g class="diente-svg" id="diente-35"><circle cx="60" cy="200" r="12" class="diente-forma"/><text x="60" y="200" class="diente-numero" font-size="10">35</text></g>
        <g class="diente-svg" id="diente-36"><circle cx="854" cy="200" r="12" class="diente-forma"/><text x="854" y="200" class="diente-numero" font-size="10">36</text></g>
        <g class="diente-svg" id="diente-37"><circle cx="80" cy="240" r="12" class="diente-forma"/><text x="80" y="240" class="diente-numero" font-size="10">37</text></g>
        <g class="diente-svg" id="diente-38"><circle cx="834" cy="240" r="12" class="diente-forma"/><text x="834" y="240" class="diente-numero" font-size="10">38</text></g>
        <g class="diente-svg" id="diente-39"><circle cx="100" cy="280" r="12" class="diente-forma"/><text x="100" y="280" class="diente-numero" font-size="10">39</text></g>
        <g class="diente-svg" id="diente-40"><circle cx="814" cy="280" r="12" class="diente-forma"/><text x="814" y="280" class="diente-numero" font-size="10">40</text></g>
        
        <g class="diente-svg" id="diente-41"><circle cx="80" cy="520" r="15" class="diente-forma"/><text x="80" y="520" class="diente-numero" font-size="12">41</text></g>
        <g class="diente-svg" id="diente-42"><circle cx="834" cy="520" r="15" class="diente-forma"/><text x="834" y="520" class="diente-numero" font-size="12">42</text></g>
        <g class="diente-svg" id="diente-43"><circle cx="60" cy="400" r="12" class="diente-forma"/><text x="60" y="400" class="diente-numero" font-size="10">43</text></g>
        <g class="diente-svg" id="diente-44"><circle cx="854" cy="400" r="12" class="diente-forma"/><text x="854" y="400" class="diente-numero" font-size="10">44</text></g>
        <g class="diente-svg" id="diente-45"><circle cx="80" cy="360" r="12" class="diente-forma"/><text x="80" y="360" class="diente-numero" font-size="10">45</text></g>
        <g class="diente-svg" id="diente-46"><circle cx="834" cy="360" r="12" class="diente-forma"/><text x="834" y="360" class="diente-numero" font-size="10">46</text></g>
        <g class="diente-svg" id="diente-47"><circle cx="100" cy="320" r="12" class="diente-forma"/><text x="100" y="320" class="diente-numero" font-size="10">47</text></g>
        <g class="diente-svg" id="diente-48"><circle cx="814" cy="320" r="12" class="diente-forma"/><text x="814" y="320" class="diente-numero" font-size="10">48</text></g>
    </svg>
</div>

<script>
(function() {
    'use strict';
    
    function log(mensaje) {
        console.log(`[ODONTOGRAMA SVG] ${mensaje}`);
    }
    
    document.addEventListener('DOMContentLoaded', function() {
        log('Iniciando odontograma SVG limpio');
        
        const dientes = document.querySelectorAll('.diente-svg');
        log(`Configurando ${dientes.length} dientes`);
        
        dientes.forEach(function(diente, index) {
            diente.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                log(`Clic en ${diente.id}`);
                
                // Quitar selección anterior
                document.querySelectorAll('.diente-svg').forEach(d => {
                    d.classList.remove('selected');
                });
                
                // Seleccionar este diente
                diente.classList.add('selected');
                
                const numero = diente.id.replace('diente-', '');
                log(`Diente ${numero} seleccionado`);
                
                // Emitir evento
                const evento = new CustomEvent('dienteSeleccionado', {
                    detail: { 
                        numero: numero, 
                        elemento: diente,
                        tipo: 'svg-limpio'
                    },
                    bubbles: true
                });
                
                document.dispatchEvent(evento);
                
                // Feedback visual temporal
                const forma = diente.querySelector('.diente-forma');
                if (forma) {
                    const colorOriginal = forma.getAttribute('fill');
                    forma.setAttribute('fill', '#ffeb3b');
                    setTimeout(() => {
                        if (!diente.classList.contains('sano') && !diente.classList.contains('caries')) {
                            forma.setAttribute('fill', colorOriginal || '');
                        }
                    }, 800);
                }
            });
            
            // Confirmar configuración
            if (index < 5) { // Solo log para los primeros 5
                log(`✓ Configurado ${diente.id}`);
            }
        });
        
        log('✅ Odontograma SVG limpio listo');
    });
})();
</script>