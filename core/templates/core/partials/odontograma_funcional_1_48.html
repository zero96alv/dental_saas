{% load math_filters %}
<div id="odontograma-funcional-container" class="odontograma-funcional">
    <!-- SVG Principal - Numeración 1-48 -->
    <svg id="odontograma-funcional-svg" 
         class="odontograma-funcional" 
         viewBox="0 0 1000 500" 
         xmlns="http://www.w3.org/2000/svg"
         preserveAspectRatio="xMidYMid meet">
        
        <!-- Estilos CSS integrados -->
        <defs>
            <style>
                /* Estilos para dientes simples y funcionales */
                .diente-funcional {
                    cursor: pointer;
                    transition: all 0.3s ease;
                }
                
                .diente-funcional:hover {
                    filter: brightness(1.1) drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
                    transform: scale(1.05);
                }
                
                .diente-funcional.seleccionado {
                    filter: brightness(1.2) drop-shadow(3px 3px 8px rgba(0,123,255,0.8));
                    transform: scale(1.1);
                }
                
                .diente-corona {
                    fill: #ffffff;
                    stroke: #666;
                    stroke-width: 2;
                    transition: all 0.3s ease;
                }
                
                .numero-diente {
                    font-size: 13px;
                    font-weight: bold;
                    fill: #333;
                    text-anchor: middle;
                    pointer-events: none;
                    font-family: 'Segoe UI', Arial, sans-serif;
                }
                
                /* Estados de diagnóstico con colores más visibles */
                .sano .diente-corona { 
                    fill: #e8f5e8; 
                    stroke: #4caf50; 
                    stroke-width: 2.5;
                }
                .caries .diente-corona { 
                    fill: #ffebee; 
                    stroke: #f44336; 
                    stroke-width: 2.5;
                }
                .obturada .diente-corona { 
                    fill: #fff3c4; 
                    stroke: #ffc107; 
                    stroke-width: 2.5;
                }
                .corona .diente-corona { 
                    fill: #e3f2fd; 
                    stroke: #2196f3; 
                    stroke-width: 2.5;
                }
                .extraida .diente-corona { 
                    fill: #f5f5f5; 
                    stroke: #9e9e9e; 
                    stroke-dasharray: 5,3; 
                    opacity: 0.7; 
                }
                .implante .diente-corona { 
                    fill: #eceff1; 
                    stroke: #607d8b; 
                    stroke-width: 3; 
                }
                .endodoncia .diente-corona { 
                    fill: #fce4ec; 
                    stroke: #e91e63; 
                    stroke-width: 2.5;
                }
                
                /* Responsivo */
                @media (max-width: 768px) {
                    .numero-diente {
                        font-size: 11px;
                    }
                }
            </style>
        </defs>

        <!-- Fondo con gradiente sutil -->
        <defs>
            <linearGradient id="fondoGradiente" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#f8f9fa;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#e9ecef;stop-opacity:1" />
            </linearGradient>
        </defs>
        <rect width="100%" height="100%" fill="url(#fondoGradiente)"/>
        
        <!-- Líneas de referencia -->
        <line x1="500" y1="50" x2="500" y2="450" stroke="#dee2e6" stroke-width="1" stroke-dasharray="3,3"/>
        <line x1="100" y1="250" x2="900" y2="250" stroke="#dee2e6" stroke-width="2"/>
        
        <!-- Etiquetas de arcadas -->
        <text x="500" y="40" font-size="18" font-weight="bold" fill="#6c757d" text-anchor="middle">SUPERIOR</text>
        <text x="500" y="480" font-size="18" font-weight="bold" fill="#6c757d" text-anchor="middle">INFERIOR</text>
        
        <!-- ARCADA SUPERIOR (Dientes 1-16) -->
        <g id="arcada-superior">
            <!-- Diente 1 (Tercer molar superior derecho) -->
            <g class="diente-funcional" id="diente-1" data-numero="1">
                <rect x="180" y="120" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="196" y="146">1</text>
            </g>
            
            <!-- Diente 2 (Segundo molar superior derecho) -->
            <g class="diente-funcional" id="diente-2" data-numero="2">
                <rect x="220" y="125" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="236" y="151">2</text>
            </g>
            
            <!-- Diente 3 (Primer molar superior derecho) -->
            <g class="diente-funcional" id="diente-3" data-numero="3">
                <rect x="260" y="130" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="276" y="156">3</text>
            </g>
            
            <!-- Diente 4 (Segundo premolar superior derecho) -->
            <g class="diente-funcional" id="diente-4" data-numero="4">
                <rect x="300" y="135" width="28" height="38" rx="5" class="diente-corona"/>
                <text class="numero-diente" x="314" y="159">4</text>
            </g>
            
            <!-- Diente 5 (Primer premolar superior derecho) -->
            <g class="diente-funcional" id="diente-5" data-numero="5">
                <rect x="335" y="140" width="28" height="38" rx="5" class="diente-corona"/>
                <text class="numero-diente" x="349" y="164">5</text>
            </g>
            
            <!-- Diente 6 (Canino superior derecho) -->
            <g class="diente-funcional" id="diente-6" data-numero="6">
                <polygon points="370,145 390,145 385,188 375,188" class="diente-corona"/>
                <text class="numero-diente" x="380" y="171">6</text>
            </g>
            
            <!-- Diente 7 (Incisivo lateral superior derecho) -->
            <g class="diente-funcional" id="diente-7" data-numero="7">
                <rect x="400" y="150" width="24" height="35" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="412" y="172">7</text>
            </g>
            
            <!-- Diente 8 (Incisivo central superior derecho) -->
            <g class="diente-funcional" id="diente-8" data-numero="8">
                <rect x="430" y="155" width="26" height="35" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="443" y="177">8</text>
            </g>
            
            <!-- Diente 9 (Incisivo central superior izquierdo) -->
            <g class="diente-funcional" id="diente-9" data-numero="9">
                <rect x="464" y="155" width="26" height="35" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="477" y="177">9</text>
            </g>
            
            <!-- Diente 10 (Incisivo lateral superior izquierdo) -->
            <g class="diente-funcional" id="diente-10" data-numero="10">
                <rect x="496" y="150" width="24" height="35" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="508" y="172">10</text>
            </g>
            
            <!-- Diente 11 (Canino superior izquierdo) -->
            <g class="diente-funcional" id="diente-11" data-numero="11">
                <polygon points="530,145 550,145 545,188 535,188" class="diente-corona"/>
                <text class="numero-diente" x="540" y="171">11</text>
            </g>
            
            <!-- Diente 12 (Primer premolar superior izquierdo) -->
            <g class="diente-funcional" id="diente-12" data-numero="12">
                <rect x="557" y="140" width="28" height="38" rx="5" class="diente-corona"/>
                <text class="numero-diente" x="571" y="164">12</text>
            </g>
            
            <!-- Diente 13 (Segundo premolar superior izquierdo) -->
            <g class="diente-funcional" id="diente-13" data-numero="13">
                <rect x="592" y="135" width="28" height="38" rx="5" class="diente-corona"/>
                <text class="numero-diente" x="606" y="159">13</text>
            </g>
            
            <!-- Diente 14 (Primer molar superior izquierdo) -->
            <g class="diente-funcional" id="diente-14" data-numero="14">
                <rect x="628" y="130" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="644" y="156">14</text>
            </g>
            
            <!-- Diente 15 (Segundo molar superior izquierdo) -->
            <g class="diente-funcional" id="diente-15" data-numero="15">
                <rect x="668" y="125" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="684" y="151">15</text>
            </g>
            
            <!-- Diente 16 (Tercer molar superior izquierdo) -->
            <g class="diente-funcional" id="diente-16" data-numero="16">
                <rect x="708" y="120" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="724" y="146">16</text>
            </g>
        </g>

        <!-- ARCADA INFERIOR (Dientes 17-32) -->
        <g id="arcada-inferior">
            <!-- Diente 17 (Tercer molar inferior derecho) -->
            <g class="diente-funcional" id="diente-17" data-numero="17">
                <rect x="180" y="338" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="196" y="364">17</text>
            </g>
            
            <!-- Diente 18 (Segundo molar inferior derecho) -->
            <g class="diente-funcional" id="diente-18" data-numero="18">
                <rect x="220" y="333" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="236" y="359">18</text>
            </g>
            
            <!-- Diente 19 (Primer molar inferior derecho) -->
            <g class="diente-funcional" id="diente-19" data-numero="19">
                <rect x="260" y="328" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="276" y="354">19</text>
            </g>
            
            <!-- Diente 20 (Segundo premolar inferior derecho) -->
            <g class="diente-funcional" id="diente-20" data-numero="20">
                <rect x="300" y="327" width="28" height="38" rx="5" class="diente-corona"/>
                <text class="numero-diente" x="314" y="351">20</text>
            </g>
            
            <!-- Diente 21 (Primer premolar inferior derecho) -->
            <g class="diente-funcional" id="diente-21" data-numero="21">
                <rect x="335" y="322" width="28" height="38" rx="5" class="diente-corona"/>
                <text class="numero-diente" x="349" y="346">21</text>
            </g>
            
            <!-- Diente 22 (Canino inferior derecho) -->
            <g class="diente-funcional" id="diente-22" data-numero="22">
                <polygon points="370,312 390,312 385,355 375,355" class="diente-corona"/>
                <text class="numero-diente" x="380" y="338">22</text>
            </g>
            
            <!-- Diente 23 (Incisivo lateral inferior derecho) -->
            <g class="diente-funcional" id="diente-23" data-numero="23">
                <rect x="400" y="315" width="24" height="35" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="412" y="337">23</text>
            </g>
            
            <!-- Diente 24 (Incisivo central inferior derecho) -->
            <g class="diente-funcional" id="diente-24" data-numero="24">
                <rect x="430" y="310" width="26" height="35" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="443" y="332">24</text>
            </g>
            
            <!-- Diente 25 (Incisivo central inferior izquierdo) -->
            <g class="diente-funcional" id="diente-25" data-numero="25">
                <rect x="464" y="310" width="26" height="35" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="477" y="332">25</text>
            </g>
            
            <!-- Diente 26 (Incisivo lateral inferior izquierdo) -->
            <g class="diente-funcional" id="diente-26" data-numero="26">
                <rect x="496" y="315" width="24" height="35" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="508" y="337">26</text>
            </g>
            
            <!-- Diente 27 (Canino inferior izquierdo) -->
            <g class="diente-funcional" id="diente-27" data-numero="27">
                <polygon points="530,312 550,312 545,355 535,355" class="diente-corona"/>
                <text class="numero-diente" x="540" y="338">27</text>
            </g>
            
            <!-- Diente 28 (Primer premolar inferior izquierdo) -->
            <g class="diente-funcional" id="diente-28" data-numero="28">
                <rect x="557" y="322" width="28" height="38" rx="5" class="diente-corona"/>
                <text class="numero-diente" x="571" y="346">28</text>
            </g>
            
            <!-- Diente 29 (Segundo premolar inferior izquierdo) -->
            <g class="diente-funcional" id="diente-29" data-numero="29">
                <rect x="592" y="327" width="28" height="38" rx="5" class="diente-corona"/>
                <text class="numero-diente" x="606" y="351">29</text>
            </g>
            
            <!-- Diente 30 (Primer molar inferior izquierdo) -->
            <g class="diente-funcional" id="diente-30" data-numero="30">
                <rect x="628" y="328" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="644" y="354">30</text>
            </g>
            
            <!-- Diente 31 (Segundo molar inferior izquierdo) -->
            <g class="diente-funcional" id="diente-31" data-numero="31">
                <rect x="668" y="333" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="684" y="359">31</text>
            </g>
            
            <!-- Diente 32 (Tercer molar inferior izquierdo) -->
            <g class="diente-funcional" id="diente-32" data-numero="32">
                <rect x="708" y="338" width="32" height="42" rx="6" class="diente-corona"/>
                <text class="numero-diente" x="724" y="364">32</text>
            </g>
        </g>

        <!-- DIENTES SUPERNUMERARIOS (33-48) -->
        <g id="supernumerarios">
            <!-- Dientes 33-40 (superiores adicionales) -->
            <g class="diente-funcional supernumerario" id="diente-33" data-numero="33">
                <rect x="130" y="110" width="24" height="32" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="142" y="130">33</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-34" data-numero="34">
                <rect x="750" y="110" width="24" height="32" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="762" y="130">34</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-35" data-numero="35">
                <rect x="160" y="200" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="170" y="218">35</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-36" data-numero="36">
                <rect x="740" y="200" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="750" y="218">36</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-37" data-numero="37">
                <rect x="200" y="205" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="210" y="223">37</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-38" data-numero="38">
                <rect x="700" y="205" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="710" y="223">38</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-39" data-numero="39">
                <rect x="240" y="210" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="250" y="228">39</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-40" data-numero="40">
                <rect x="660" y="210" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="670" y="228">40</text>
            </g>
            
            <!-- Dientes 41-48 (inferiores adicionales) -->
            <g class="diente-funcional supernumerario" id="diente-41" data-numero="41">
                <rect x="130" y="390" width="24" height="32" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="142" y="410">41</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-42" data-numero="42">
                <rect x="750" y="390" width="24" height="32" rx="4" class="diente-corona"/>
                <text class="numero-diente" x="762" y="410">42</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-43" data-numero="43">
                <rect x="160" y="270" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="170" y="288">43</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-44" data-numero="44">
                <rect x="740" y="270" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="750" y="288">44</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-45" data-numero="45">
                <rect x="200" y="265" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="210" y="283">45</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-46" data-numero="46">
                <rect x="700" y="265" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="710" y="283">46</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-47" data-numero="47">
                <rect x="240" y="260" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="250" y="278">47</text>
            </g>
            <g class="diente-funcional supernumerario" id="diente-48" data-numero="48">
                <rect x="660" y="260" width="20" height="28" rx="3" class="diente-corona"/>
                <text class="numero-diente" x="670" y="278">48</text>
            </g>
        </g>
    </svg>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Odontograma funcional cargado - Numeración 1-48');
    
    // Configurar eventos de clic para todos los dientes
    const dientes = document.querySelectorAll('.diente-funcional');
    
    dientes.forEach(function(diente) {
        diente.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // Remover selección anterior
            document.querySelectorAll('.diente-funcional').forEach(d => {
                d.classList.remove('seleccionado');
            });
            
            // Seleccionar diente actual
            diente.classList.add('seleccionado');
            
            // Obtener número del diente
            const numeroDiente = diente.getAttribute('data-numero') || diente.id.replace('diente-', '');
            
            console.log('Diente seleccionado:', numeroDiente);
            
            // Emitir evento personalizado
            const evento = new CustomEvent('dienteSeleccionadoFuncional', {
                detail: {
                    numero: numeroDiente,
                    elemento: diente,
                    tipo: 'funcional'
                },
                bubbles: true
            });
            
            document.dispatchEvent(evento);
        });
        
        // Efecto hover adicional
        diente.addEventListener('mouseenter', function() {
            if (!diente.classList.contains('seleccionado')) {
                diente.style.transform = 'scale(1.05)';
            }
        });
        
        diente.addEventListener('mouseleave', function() {
            if (!diente.classList.contains('seleccionado')) {
                diente.style.transform = 'scale(1)';
            }
        });
    });
    
    console.log(`${dientes.length} dientes configurados con eventos`);
});
</script>